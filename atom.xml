<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Felix Chen</title>
  <icon>https://blog.felixchen0707.cn/icon.png</icon>
  <subtitle>所见一切皆是奇迹。</subtitle>
  <link href="https://blog.felixchen0707.cn/atom.xml" rel="self"/>
  
  <link href="https://blog.felixchen0707.cn/"/>
  <updated>2022-11-14T16:00:00.000Z</updated>
  <id>https://blog.felixchen0707.cn/</id>
  
  <author>
    <name>Felix Chen</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Stellar动态友链分组</title>
    <link href="https://blog.felixchen0707.cn/posts/36ee0b0c/"/>
    <id>https://blog.felixchen0707.cn/posts/36ee0b0c/</id>
    <published>2022-11-13T13:30:31.000Z</published>
    <updated>2022-11-14T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>我们时常希望博客的友链界面能够对不同的友链分组；stellar的动态友链功能又十分强大，但所有导出的数据都会写入一个文件。这篇文章记录对动态友链生成仓库的改造，使之能够进行友链分类。</p><span id="more"></span><div class="tag-plugin note" color="blue"><div class="title"><strong>11月15日更新</strong></div><div class="body"><p>最新版本的动态友联已经支持输出到自定义文件，因此读者继续参考本文时请注意文章的时效性。</p></div></div><div class="tag-plugin note" color="yellow"><div class="body"><p>由于本文对于仓库源码有一定的改动，请先确认你是否确实有这个需求，而后再理性地选择是否魔改。</p></div></div><p>废话我就不多说了，我们直接开始。</p><h1 id="fork动态友链抓取仓库">fork动态友链抓取仓库</h1><p>首先，你需要fork动态友链抓取仓库，链接如下：</p><div class="tag-plugin link dis-select"><a class="link-card plain" title="" href="https://github.com/xaoxuu/issues-json-generator" target="_blank" rel="external nofollow noopener noreferrer" cardlink autofill="title,icon"><div class="left"><span class="title">https://github.com/xaoxuu/issues-json-generator</span><span class="cap link fs12">https://github.com/xaoxuu/issues-json-generator</span></div><div class="right"><div class="lazy img" data-bg="https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/link/8f277b4ee0ecd.svg"></div></div></a></div><p>根据README内容完成配置。这里我就不多赘述了，需要保证你的workflow能够正确运行并且<code>output</code>分支能看到输出的<code>data.json</code>文件。</p><h1 id="代码修改">代码修改</h1><p>在这个魔改中需要修改两部分内容(均处于<code>main</code>分支下)：<code>config.yml</code>和<code>generator/main.py</code>。这里先给出两者的文件：</p><div class="tag-plugin note" color="blue"><div class="title"><strong>提示</strong></div><div class="body"><p>在复制源码前，我建议你看看我都改了什么。这有助于你对代码有宏观的把握，也对程序中可能出现的问题有解决想法。</p></div></div><h2 id="config.yml">config.yml</h2><div class="tag-plugin tabs"id="tab_2"><div class="nav-tabs"><div class="tab active"><a href="#tab_2-1">diff</a></div><div class="tab"><a href="#tab_2-2">源文件</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_2-1"><figure class="highlight diff"><figcaption><span>config.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 网络请求设置</span><br><span class="line">request:</span><br><span class="line">  timeout: 10 # 超时设置</span><br><span class="line">  ssl: false # ssl设置</span><br><span class="line"></span><br><span class="line"># 要抓取的 issues 配置</span><br><span class="line">issues:</span><br><span class="line">  repo: felixchen0707/friendLink_api # 仓库持有者/仓库名</span><br><span class="line">  label: active # 筛选具有 active 标签的 issue ，取消此项则会提取所有 open 状态的 issue</span><br><span class="line"><span class="addition">+ className:</span></span><br><span class="line"><span class="addition">+   - &#x27;ordinary&#x27;</span></span><br><span class="line"><span class="addition">+   - &#x27;top&#x27;</span></span><br><span class="line">  sort: updated-desc # 排序，按最近更新，取消此项则按创建时间排序</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="tab_2-2"><figure class="highlight yaml"><figcaption><span>config.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 网络请求设置</span></span><br><span class="line"><span class="attr">request:</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="number">10</span> <span class="comment"># 超时设置</span></span><br><span class="line">  <span class="attr">ssl:</span> <span class="literal">false</span> <span class="comment"># ssl设置</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 要抓取的 issues 配置</span></span><br><span class="line"><span class="attr">issues:</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">felixchen0707/friendLink_api</span> <span class="comment"># 仓库持有者/仓库名</span></span><br><span class="line">  <span class="attr">label:</span> <span class="string">active</span> <span class="comment"># 筛选具有 active 标签的 issue ，取消此项则会提取所有 open 状态的 issue</span></span><br><span class="line">  <span class="attr">className:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;ordinary&#x27;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;top&#x27;</span></span><br><span class="line">  <span class="attr">sort:</span> <span class="string">updated-desc</span> <span class="comment"># 排序，按最近更新，取消此项则按创建时间排序</span></span><br></pre></td></tr></table></figure></div></div></div><h2 id="generatormain.py">generator/main.py</h2><div class="tag-plugin tabs"id="tab_3"><div class="nav-tabs"><div class="tab active"><a href="#tab_3-1">diff</a></div><div class="tab"><a href="#tab_3-2">源文件</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_3-1"><figure class="highlight diff"><figcaption><span>generator/main.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># author: https://github.com/Zfour</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">import os</span><br><span class="line">import request</span><br><span class="line">import json</span><br><span class="line">import config</span><br><span class="line"></span><br><span class="line">version = &#x27;v2&#x27;</span><br><span class="line">outputdir = version  # 输出文件结构变化时，更新输出路径版本</span><br><span class="line"><span class="deletion">- filename = &#x27;data.json&#x27;</span></span><br><span class="line"></span><br><span class="line">data_pool = []</span><br><span class="line"></span><br><span class="line"><span class="addition">+ cfg = config.load()</span></span><br><span class="line"><span class="addition">+ filter = cfg[&#x27;issues&#x27;]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def mkdir(path):</span><br><span class="line">    folder = os.path.exists(path)</span><br><span class="line">    if not folder:</span><br><span class="line">        os.makedirs(path)</span><br><span class="line">        print(&quot;create dir:&quot;, path)</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;dir exists:&quot;, path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="deletion">- def github_issuse(data_pool):</span></span><br><span class="line"><span class="addition">+ def github_issuse(data_pool, className):</span></span><br><span class="line">    print(&#x27;\n&#x27;)</span><br><span class="line">    print(&#x27;------- github issues start ----------&#x27;)</span><br><span class="line"><span class="addition">+   print(&#x27;is catching label:&#x27; + className)</span></span><br><span class="line">    baselink = &#x27;https://github.com/&#x27;</span><br><span class="line"><span class="deletion">-   cfg = config.load()</span></span><br><span class="line"><span class="deletion">-   filter = cfg[&#x27;issues&#x27;]</span></span><br><span class="line">    try:</span><br><span class="line">        for number in range(1, 100):</span><br><span class="line">            print(&#x27;page:&#x27;, number)</span><br><span class="line">            url = &#x27;https://github.com/&#x27; + filter[&#x27;repo&#x27;] + &#x27;/issues?page=&#x27; + str(number) + &#x27;&amp;q=is%3Aopen&#x27;</span><br><span class="line">            if filter[&#x27;label&#x27;]:</span><br><span class="line"><span class="deletion">-           url = url + &#x27;+label%3A&#x27; + filter[&#x27;label&#x27;]</span></span><br><span class="line"><span class="addition">+           url = url + &#x27;+label%3A&#x27; + filter[&#x27;label&#x27;] + &#x27;+label%3A&#x27; + className</span></span><br><span class="line">            if filter[&#x27;sort&#x27;]:</span><br><span class="line">                url = url + &#x27;+sort%3A&#x27; + filter[&#x27;sort&#x27;]</span><br><span class="line">            print(&#x27;parse:&#x27;, url)</span><br><span class="line">            github = request.get_data(url)</span><br><span class="line">            soup = BeautifulSoup(github, &#x27;html.parser&#x27;)</span><br><span class="line">            main_content = soup.find_all(&#x27;div&#x27;, &#123;&#x27;aria-label&#x27;: &#x27;Issues&#x27;&#125;)</span><br><span class="line">            linklist = main_content[0].find_all(&#x27;a&#x27;, &#123;&#x27;class&#x27;: &#x27;Link--primary&#x27;&#125;)</span><br><span class="line">            if len(linklist) == 0:</span><br><span class="line">                print(&#x27;&gt; end&#x27;)</span><br><span class="line">                break</span><br><span class="line">            for item in linklist:</span><br><span class="line">                issueslink = baselink + item[&#x27;href&#x27;]</span><br><span class="line">                issues_page = request.get_data(issueslink)</span><br><span class="line">                issues_soup = BeautifulSoup(issues_page, &#x27;html.parser&#x27;)</span><br><span class="line">                try:</span><br><span class="line">                    issues_linklist = issues_soup.find_all(&#x27;pre&#x27;)</span><br><span class="line">                    source = issues_linklist[0].text</span><br><span class="line">                    if &quot;&#123;&quot; in source:</span><br><span class="line">                        source = json.loads(source)</span><br><span class="line">                        print(source)</span><br><span class="line">                        data_pool.append(source)</span><br><span class="line">                except:</span><br><span class="line">                    continue</span><br><span class="line">    except Exception as e:</span><br><span class="line"><span class="deletion">-       print(&#x27;&gt; end&#x27;)</span></span><br><span class="line"><span class="addition">+       print(&#x27;&gt; end catching label:&#x27; + className)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(&#x27;------- github issues end ----------&#x27;)</span><br><span class="line">print(&#x27;\n&#x27;)</span><br><span class="line"></span><br><span class="line"># 友链规则</span><br><span class="line"><span class="addition">+ for className in filter[&#x27;className&#x27;]:</span></span><br><span class="line"><span class="addition">+   data_pool.clear()</span></span><br><span class="line"><span class="deletion">-   github_issuse(data_pool=data_pool)</span></span><br><span class="line"><span class="addition">+   github_issuse(data_pool=data_pool, className=className)</span></span><br><span class="line">    mkdir(outputdir)</span><br><span class="line"><span class="deletion">-   full_path = outputdir + &#x27;/&#x27; + filename</span></span><br><span class="line"><span class="addition">+   full_path = outputdir + &#x27;/&#x27; + className + &#x27;.json&#x27;</span></span><br><span class="line">    with open(full_path, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;) as file_obj:</span><br><span class="line">        data = &#123;</span><br><span class="line">            &#x27;version&#x27;: version,</span><br><span class="line">            &#x27;content&#x27;: data_pool</span><br><span class="line">        &#125;</span><br><span class="line">        json.dump(data, file_obj, ensure_ascii=False, indent=2)</span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="tab_3-2"><figure class="highlight python"><figcaption><span>generator/main.py</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># author: https://github.com/Zfour</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> config</span><br><span class="line"></span><br><span class="line">version = <span class="string">&#x27;v2&#x27;</span></span><br><span class="line">outputdir = version  <span class="comment"># 输出文件结构变化时，更新输出路径版本</span></span><br><span class="line"></span><br><span class="line">data_pool = []</span><br><span class="line"></span><br><span class="line">cfg = config.load()</span><br><span class="line"><span class="built_in">filter</span> = cfg[<span class="string">&#x27;issues&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mkdir</span>(<span class="params">path</span>):</span><br><span class="line">    folder = os.path.exists(path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> folder:</span><br><span class="line">        os.makedirs(path)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;create dir:&quot;</span>, path)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;dir exists:&quot;</span>, path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">github_issuse</span>(<span class="params">data_pool, className</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;------- github issues start ----------&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;is catching label:&#x27;</span> + className)</span><br><span class="line">    baselink = <span class="string">&#x27;https://github.com/&#x27;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> number <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;page:&#x27;</span>, number)</span><br><span class="line">            url = <span class="string">&#x27;https://github.com/&#x27;</span> + <span class="built_in">filter</span>[<span class="string">&#x27;repo&#x27;</span>] + <span class="string">&#x27;/issues?page=&#x27;</span> + <span class="built_in">str</span>(number) + <span class="string">&#x27;&amp;q=is%3Aopen&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">filter</span>[<span class="string">&#x27;label&#x27;</span>]:</span><br><span class="line">                url = url + <span class="string">&#x27;+label%3A&#x27;</span> + <span class="built_in">filter</span>[<span class="string">&#x27;label&#x27;</span>] + <span class="string">&#x27;+label%3A&#x27;</span> + className</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">filter</span>[<span class="string">&#x27;sort&#x27;</span>]:</span><br><span class="line">                url = url + <span class="string">&#x27;+sort%3A&#x27;</span> + <span class="built_in">filter</span>[<span class="string">&#x27;sort&#x27;</span>]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;parse:&#x27;</span>, url)</span><br><span class="line">            github = request.get_data(url)</span><br><span class="line">            soup = BeautifulSoup(github, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">            main_content = soup.find_all(<span class="string">&#x27;div&#x27;</span>, &#123;<span class="string">&#x27;aria-label&#x27;</span>: <span class="string">&#x27;Issues&#x27;</span>&#125;)</span><br><span class="line">            linklist = main_content[<span class="number">0</span>].find_all(<span class="string">&#x27;a&#x27;</span>, &#123;<span class="string">&#x27;class&#x27;</span>: <span class="string">&#x27;Link--primary&#x27;</span>&#125;)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(linklist) == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;&gt; end&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> linklist:</span><br><span class="line">                issueslink = baselink + item[<span class="string">&#x27;href&#x27;</span>]</span><br><span class="line">                issues_page = request.get_data(issueslink)</span><br><span class="line">                issues_soup = BeautifulSoup(issues_page, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    issues_linklist = issues_soup.find_all(<span class="string">&#x27;pre&#x27;</span>)</span><br><span class="line">                    source = issues_linklist[<span class="number">0</span>].text</span><br><span class="line">                    <span class="keyword">if</span> <span class="string">&quot;&#123;&quot;</span> <span class="keyword">in</span> source:</span><br><span class="line">                        source = json.loads(source)</span><br><span class="line">                        <span class="built_in">print</span>(source)</span><br><span class="line">                        data_pool.append(source)</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&gt; end catching label:&#x27;</span> + className)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;------- github issues end ----------&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 友链规则</span></span><br><span class="line"><span class="keyword">for</span> className <span class="keyword">in</span> <span class="built_in">filter</span>[<span class="string">&#x27;className&#x27;</span>]:</span><br><span class="line">    data_pool.clear()</span><br><span class="line">    github_issuse(data_pool=data_pool, className=className)</span><br><span class="line">    mkdir(outputdir)</span><br><span class="line">    full_path = outputdir + <span class="string">&#x27;/&#x27;</span> + className + <span class="string">&#x27;.json&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(full_path, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file_obj:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;version&#x27;</span>: version,</span><br><span class="line">            <span class="string">&#x27;content&#x27;</span>: data_pool</span><br><span class="line">        &#125;</span><br><span class="line">        json.dump(data, file_obj, ensure_ascii=<span class="literal">False</span>, indent=<span class="number">2</span>)</span><br></pre></td></tr></table></figure></div></div></div><h1 id="如何配置classname">如何配置className</h1><p>在我的构想中，一个网站应该由两部分构成：<strong>网站状态</strong>和<strong>网站分类</strong>。前者通过<code>active</code>、<code>404</code>、<code>suspend</code>这类的label进行标记；后者则是你自定义的分类。</p><p>对于你自定义的分类名称，你需要写在<code>config.yml</code>中的<code>className</code>项中，例如我这里用<code>ordinary</code>和<code>top</code>来区分一般友链和置顶友链。经过配置后的<code>className</code>包含的元素会在执行action的时候依次被作为label<strong>单独抓取</strong>合适的友链，例如下图是我的友链仓库：</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/11/13/teJUg.png" alt="我的友链仓库" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">我的友链仓库</span></div></div><p>其中，标记为<code>active</code>的issue表示允许被抓取，而标记为<code>top</code>和<code>ordinary</code>的issue会在抓取<code>top</code>和<code>ordinary</code>的两批抓取中分别被抓取，来达到对友链分类的效果。</p><h1 id="期望的运行结果">期望的运行结果</h1><p>被标记为<code>classA</code>的友链将会输出至<code>output</code>分支下<code>v2/classA.json</code>文件中，其他情况类似。由于label的名字与输出文件的名字强相关，这也要求你<strong>不要用奇怪的符号作为label的内容</strong>。</p><h1 id="一些些补充">一些些补充</h1><h2 id="每个issue对应两个label">每个issue对应两个label</h2><p>由于我使用<strong>站点状态</strong>和<strong>站点分类</strong>来分别表示一个网站，因此每一个issue至少都有两个label标记。例如，你的<code>config.yml</code>中配置了：</p><figure class="highlight yaml"><figcaption><span>config.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">issues:</span></span><br><span class="line">    <span class="attr">label:</span> <span class="string">active</span></span><br></pre></td></tr></table></figure><p>若你仅仅为一个issue打上了<code>ordinary</code>标记而没有加上<code>active</code>标记或者反之，则该issue都不会被读取到。</p><h2 id="加快访问速度">加快访问速度</h2><p>由于直接访问github的速度极慢，你可以使用Vercel构建该仓库来达到加速访问的效果。在你的Vercel的面板界面(dashboard)新建项目，导入你的友链数据仓库并点击deploy。<strong>由于你的输出内容一般不在<code>main</code>分支但是Vercel却会默认构建<code>main</code>分支，你需要进行以下操作</strong>：</p><p>点开项目，进入<code>Settings-&gt;Git</code>界面，找到<code>Production Branch</code>配置项，将分支名称从<code>main/master</code>改成<code>output</code>。下次向<code>output</code>分支推送时，Vercel就会重新改为部署该分支了。</p><h1 id="致谢">致谢</h1><ul><li><ahref="https://github.com/xaoxuu/issues-json-generator">xaoxuu/issues-json-generator</a></li><li><a href="https://blog.beacox.space/">BeaCox</a>的灵感</li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;我们时常希望博客的友链界面能够对不同的友链分组；stellar的动态友链功能又十分强大，但所有导出的数据都会写入一个文件。这篇文章记录对动态友链生成仓库的改造，使之能够进行友链分类。&lt;/p&gt;</summary>
    
    
    
    <category term="博客" scheme="https://blog.felixchen0707.cn/categories/%E5%8D%9A%E5%AE%A2/"/>
    
    
    <category term="博客" scheme="https://blog.felixchen0707.cn/tags/%E5%8D%9A%E5%AE%A2/"/>
    
  </entry>
  
  <entry>
    <title>利用Github Action部署博客</title>
    <link href="https://blog.felixchen0707.cn/posts/477696ac/"/>
    <id>https://blog.felixchen0707.cn/posts/477696ac/</id>
    <published>2022-11-10T14:47:21.000Z</published>
    <updated>2022-11-09T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言">前言</h1><p>刚开始建立博客的时候，我一直采取的是本地<code>hexo g</code>后<code>hexo d</code>推送到Github的仓库中。这是利用hexo搭建博客最简单的部署方式。然后后续发现，源文件在这种情况下很容易丢失，备份的话又显得比较麻烦。后来了解到GithubAction的强大功能，加上阅读了<ahref="https://sanonz.github.io/2020/deploy-a-hexo-blog-from-github-actions/">这篇</a>教程后，现在已经实现将源文件推送到某个Github仓库，而后由仓库自动执行GithubAction推送静态文件到另一个仓库(一般是我们的<code>.github.io</code>仓库)来代替我们在本地完成<code>hexo g -d</code>操作，同时也能托管我们的源文件。由于上面那篇教程年代有些许久远，这篇文章主要提供能够直接抄作业的workflow供大家使用。</p><h1 id="操作步骤">操作步骤</h1><h2 id="创建需要用到的仓库">创建需要用到的仓库</h2><p>首先需要创建两个仓库，一个用于存放源文件，另一个存放生成的静态文件。以我的为例，用<code>felixchen0707/MyBlogSourceCode</code>存放源文件，用<code>felixchen0707/MyBlog</code>存放静态文件。</p><div class="tag-plugin note" color="yellow"><div class="title"><strong>提醒</strong></div><div class="body"><p>值得注意的是，你也可以在同一个仓库中创建两个分支，在两个分支中分别存放源文件和静态文件。但并不推荐这么做，因为若这样做，也就意味着你的源文件和静态文件只能同时为public或者private，而且github仓库数目也并没有那么紧张，分开存放利远大于弊。</p></div></div><h2 id="生成密钥">生成密钥</h2><p>由于对仓库的写入需要特别的权限，因此你需要生成密钥对。在bash键入如下命令：</p><div class="tag-plugin copy"><input class="copy-area" readonly id="copy_12" value="ssh-keygen -f github-deploy-key"><button class="copy-btn" onclick="util.copy(&quot;copy_12&quot;,&quot;Copied!&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><p>你可以在当前文件夹下看到两个文件，分别为<code>github-deploy-key</code>和<code>github-deploy-key.pub</code>，前者为私钥，后者为公钥。</p><div class="tag-plugin note" color="yellow"><div class="title"><strong>注意</strong></div><div class="body"><p>请务必保证私钥的保密性。</p></div></div><h2 id="为仓库配置公钥和私钥">为仓库配置公钥和私钥</h2><h3 id="源文件仓库">源文件仓库</h3><p>首先前往源文件仓库配置<strong>私钥</strong>。在我提供的例子中，其为<code>felixchen0707/MyBlogSourceCode</code>。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/11/10/tkJwr.png" alt="源代码仓库" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">源代码仓库</span></div></div><p>如上图所示，为其新建一个<code>secret</code>，名称为<code>HEXO_DEPLOY_PRI</code>，内容为<code>github-deploy-key</code>文件中的全部内容(全选<kbd>Ctrl</kbd>+<kbd>A</kbd>)。</p><h3 id="静态文件仓库">静态文件仓库</h3><p>然后，前往静态文件仓库配置<strong>公钥</strong>。在我提供的例子中，为<code>felixchen0707/MyBlog</code>。</p><div class="tag-plugin note" color="yellow"><div class="title"><strong>注意</strong></div><div class="body"><p>如果使用GithubPages托管可供访问的网站，这个仓库必须是<code>你的用户名.github.io</code>，以我为例，即<code>felixchen0707.github.io</code>。</p></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/11/10/tkR1M.png" alt="静态文件仓库" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">静态文件仓库</span></div></div><p>如上图所示，添加<code>Deploy Keys</code>。<code>Title</code>为<code>HEXO_DEPLOY_PUB</code>，内容为文件<code>github-deploy-key.pub</code>的<strong>全部内容</strong>。<strong>同时，勾选下方的<code>Allow Write Access</code>来提供写入权限</strong>。若你没有勾选此选项，该密钥对没有写的权限。</p><div class="tag-plugin note" color="yellow"><div class="title"><strong>注意</strong></div><div class="body"><p>这里添加的是<code>Deploy Keys</code>而非<code>Secrets</code>，一定不要搞错。</p></div></div><h2 id="添加workflow">添加Workflow</h2><h3 id="workflow模板">workflow模板</h3><p>接下来，在你的博客根目录下新建一个文件夹，名为<code>.github</code>，其中存放的文件可以被github识别并且加以利用。新建<code>.github/workflows/auto_deploy.yml</code>编写workflow模板。其内容如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /.github/workflows/auto_deploy.yml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">name:</span> <span class="string">CI</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">GIT_USER:</span> <span class="string">felixchen0707</span></span><br><span class="line">  <span class="attr">GIT_EMAIL:</span> <span class="number">3137181992</span><span class="string">@qq.com</span></span><br><span class="line">  <span class="attr">THEME_REPO:</span> <span class="string">felixchen0707/hexo-theme-stellar</span></span><br><span class="line">  <span class="attr">THEME_BRANCH:</span> <span class="string">main</span></span><br><span class="line">  <span class="attr">DEPLOY_REPO:</span> <span class="string">felixchen0707/MyBlog</span></span><br><span class="line">  <span class="attr">DEPLOY_BRANCH:</span> <span class="string">main</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Build</span> <span class="string">on</span> <span class="string">node</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.node_version</span> <span class="string">&#125;&#125;</span> <span class="string">and</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.os</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">strategy:</span></span><br><span class="line">      <span class="attr">matrix:</span></span><br><span class="line">        <span class="attr">os:</span> [<span class="string">ubuntu-latest</span>]</span><br><span class="line">        <span class="attr">node_version:</span> [<span class="number">16.</span><span class="string">x</span>]</span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">theme</span> <span class="string">repo</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">repository:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.THEME_REPO</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">ref:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.THEME_BRANCH</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">themes/stellar</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">deploy</span> <span class="string">repo</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">repository:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.DEPLOY_REPO</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">ref:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.DEPLOY_BRANCH</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">.deploy_git</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Use</span> <span class="string">Node.js</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.node_version</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.node_version</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configuration</span> <span class="string">environment</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">HEXO_DEPLOY_PRI:</span> <span class="string">$&#123;&#123;secrets.HEXO_DEPLOY_PRI&#125;&#125;</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          sudo timedatectl set-timezone &quot;Asia/Shanghai&quot;</span></span><br><span class="line"><span class="string">          mkdir -p ~/.ssh/</span></span><br><span class="line"><span class="string">          echo &quot;$HEXO_DEPLOY_PRI&quot; &gt; ~/.ssh/id_rsa</span></span><br><span class="line"><span class="string">          chmod 600 ~/.ssh/id_rsa</span></span><br><span class="line"><span class="string">          ssh-keyscan github.com &gt;&gt; ~/.ssh/known_hosts</span></span><br><span class="line"><span class="string">          git config --global user.name $GIT_USER</span></span><br><span class="line"><span class="string">          git config --global user.email $GIT_EMAIL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">dependencies</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          npm install</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">hexo</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">npm</span> <span class="string">run</span> <span class="string">deploy</span></span><br></pre></td></tr></table></figure><p>现在对上述模板做出解释。<code>name</code>为workflow的名称，这是任意的。</p><h3 id="触发时机">触发时机</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><p>以上为workflow触发的时机，即当<code>master</code>分支有新推送时触发。这里是否是<code>master</code>由你的源文件仓库分支名决定，若为<code>main</code>，则你需要修改成：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">main</span></span><br></pre></td></tr></table></figure><h3 id="环境变量">环境变量</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">GIT_USER:</span> <span class="string">felixchen0707</span></span><br><span class="line">  <span class="attr">GIT_EMAIL:</span> <span class="number">3137181992</span><span class="string">@qq.com</span></span><br><span class="line">  <span class="attr">THEME_REPO:</span> <span class="string">felixchen0707/hexo-theme-stellar</span></span><br><span class="line">  <span class="attr">THEME_BRANCH:</span> <span class="string">main</span></span><br><span class="line">  <span class="attr">DEPLOY_REPO:</span> <span class="string">felixchen0707/MyBlog</span></span><br><span class="line">  <span class="attr">DEPLOY_BRANCH:</span> <span class="string">main</span></span><br></pre></td></tr></table></figure><p>以上为workflow运行期间的变量，各个值需要你重新设置。<code>GIT_USER</code>为你的Github名称，<code>GIT_EMAIL</code>为你的邮箱，上述两者为触发workflow部署时的提交信息内容。</p><p><code>THEME_REPO</code>和<code>THEME_BRANCH</code>指定了你的博客主题，在workflow运行时会自动拉取主题代码。<strong>我强烈建议你fork一份主题仓库来避免主题仓库更新时配置文件落后的情况发生</strong>。</p><p><code>DEPLOY_REPO</code>和<code>DEPLOY_BRANCH</code>指定了向何处推送生成的静态文件。这里即为你一开始创建的存放静态文件的仓库。</p><h3 id="定制jobs">定制jobs</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Build</span> <span class="string">on</span> <span class="string">node</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.node_version</span> <span class="string">&#125;&#125;</span> <span class="string">and</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.os</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">strategy:</span></span><br><span class="line">      <span class="attr">matrix:</span></span><br><span class="line">        <span class="attr">os:</span> [<span class="string">ubuntu-latest</span>]</span><br><span class="line">        <span class="attr">node_version:</span> [<span class="number">16.</span><span class="string">x</span>]</span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">theme</span> <span class="string">repo</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">repository:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.THEME_REPO</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">ref:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.THEME_BRANCH</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">themes/stellar</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">deploy</span> <span class="string">repo</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">repository:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.DEPLOY_REPO</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">ref:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.DEPLOY_BRANCH</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">.deploy_git</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Use</span> <span class="string">Node.js</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.node_version</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.node_version</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configuration</span> <span class="string">environment</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">HEXO_DEPLOY_PRI:</span> <span class="string">$&#123;&#123;secrets.HEXO_DEPLOY_PRI&#125;&#125;</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          sudo timedatectl set-timezone &quot;Asia/Shanghai&quot;</span></span><br><span class="line"><span class="string">          mkdir -p ~/.ssh/</span></span><br><span class="line"><span class="string">          echo &quot;$HEXO_DEPLOY_PRI&quot; &gt; ~/.ssh/id_rsa</span></span><br><span class="line"><span class="string">          chmod 600 ~/.ssh/id_rsa</span></span><br><span class="line"><span class="string">          ssh-keyscan github.com &gt;&gt; ~/.ssh/known_hosts</span></span><br><span class="line"><span class="string">          git config --global user.name $GIT_USER</span></span><br><span class="line"><span class="string">          git config --global user.email $GIT_EMAIL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">dependencies</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          npm install</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">hexo</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">npm</span> <span class="string">run</span> <span class="string">deploy</span></span><br></pre></td></tr></table></figure><p>上述为workflow的具体流程，有几个部分值得你注意。</p><h4 id="nodejs版本">nodejs版本</h4><p>不同的主题对于nodejs有不同的版本要求，你需要在<code>node_version: [16.x]</code>设置，此处是nodejs最新的稳定版本，能够满足大多数主题要求，当然，你可以指定你需要的版本。</p><h4 id="拉取主题代码">拉取主题代码</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">theme</span> <span class="string">repo</span></span><br><span class="line">    <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">    <span class="attr">with:</span></span><br><span class="line">        <span class="attr">repository:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.THEME_REPO</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">ref:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.THEME_BRANCH</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">themes/stellar</span></span><br></pre></td></tr></table></figure><p>上述步骤中，Github会拉取主题代码，仓库已由<code>THEME_REPO</code>和<code>THEME_BRANCH</code>决定。其中，你需要修改<code>path</code>的值，若为<code>themes/stellar</code>，则相当于将主题代码拉取至<code>/themes/stellar</code>下。需要注意的是，这里要和你的站点配置文件<code>_config.yml</code>中如下配置保持一致：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Extensions</span></span><br><span class="line"><span class="comment">## Plugins: https://hexo.io/plugins/</span></span><br><span class="line"><span class="comment">## Themes: https://hexo.io/themes/</span></span><br><span class="line"><span class="attr">theme:</span> <span class="string">stellar</span></span><br></pre></td></tr></table></figure><h2 id="添加.gitignore">添加.gitignore</h2><p>此时，你只需要在博客根目录下键入：</p><div class="tag-plugin copy"><input class="copy-area" readonly id="copy_13" value="git init"><button class="copy-btn" onclick="util.copy(&quot;copy_13&quot;,&quot;Copied!&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><p>将其初始化成为一个Git仓库。但提交时，有些文件是多余的，你可以将其写入<code>.gitignore</code>中，以下是一个例子：</p><figure class="highlight plaintext"><figcaption><span>.gitignore</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node_modules/</span><br><span class="line">themes/</span><br><span class="line">db.json</span><br></pre></td></tr></table></figure><p>然后提交并指定分支：</p><div class="tag-plugin copy"><input class="copy-area" readonly id="copy_14" value="git commit"><button class="copy-btn" onclick="util.copy(&quot;copy_14&quot;,&quot;Copied!&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><div class="tag-plugin copy"><input class="copy-area" readonly id="copy_15" value="git branch -M main"><button class="copy-btn" onclick="util.copy(&quot;copy_15&quot;,&quot;Copied!&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><p>然后绑定远程仓库：</p><div class="tag-plugin copy"><input class="copy-area" readonly id="copy_16" value="git remote add origin git@github.com:felixchen0707/MyBlogSourceCode.git"><button class="copy-btn" onclick="util.copy(&quot;copy_16&quot;,&quot;Copied!&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><p>最后推送即可：</p><div class="tag-plugin copy"><input class="copy-area" readonly id="copy_17" value="git push"><button class="copy-btn" onclick="util.copy(&quot;copy_17&quot;,&quot;Copied!&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><h1 id="常见问题">常见问题</h1><h2 id="插件版本的更新">插件版本的更新</h2><p>虽然我们并没有提交<code>node_modules</code>文件夹，但我们推送了<code>package.json</code>和<code>package_lock.json</code>。两个文件详细记录了我们下载的插件及他们各自的依赖，在执行workflow时，action会自动collect这些包；如果我们对于这些依赖包有更新的需求，可以配置dependabot，在如下位置开启它：</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/11/11/tktDG.png" alt="dependabot启用位置" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">dependabot启用位置</span></div></div><p>此时，<code>.github</code>下会生成如下文件：</p><figure class="highlight yaml"><figcaption><span>.github/dependabot.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">updates:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">package-ecosystem:</span> <span class="string">npm</span></span><br><span class="line">  <span class="attr">directory:</span> <span class="string">&quot;/&quot;</span></span><br><span class="line">  <span class="attr">schedule:</span></span><br><span class="line">    <span class="attr">interval:</span> <span class="string">daily</span></span><br><span class="line">  <span class="attr">open-pull-requests-limit:</span> <span class="number">20</span></span><br></pre></td></tr></table></figure><p>插件的更新会通过pr的方式告知你，你只需要merge即可。</p><p>或者你可以在本地升级插件版本，重新推送。</p><div class="tag-plugin note" color="blue"><div class="title"><strong>建议</strong></div><div class="body"><p>建议推送前先使用<code>hexo s</code>预览，因为例如<code>hexo-abbrlink</code>这类插件会在预览或生成站点时在MarkDown文件的头部增加新的键值对。</p></div></div><h2id="workflow运行提示action_bot无权限怎么办">workflow运行提示action_bot无权限怎么办</h2><p>请检查你是否安装了<code>hexo-deployer-git</code>插件，并且在配置文件中是否采取了ssh而非http连接：</p><figure class="highlight yaml"><figcaption><span>_config.yml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/one-command-deployment</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">&#x27;git&#x27;</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">git@github.com:felixchen0707/MyBlog.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">main</span></span><br></pre></td></tr></table></figure><h2 id="我这么做还有什么好处">我这么做还有什么好处？</h2><p>首先正如一开始所说的，你可以在部署时同时备份你的源文件。利用Action来部署站点，也使得你的本地环境并不依赖nodejs环境，例如你需要修改小错误时，完全也可以在手机上做到。当然，也并不是说利用GithubAction部署就一定优越，大家可以按需食用。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;前言&quot;&gt;前言&lt;/h1&gt;
&lt;p&gt;刚开始建立博客的时候，我一直采取的是本地&lt;code&gt;hexo g&lt;/code&gt;后&lt;code&gt;hexo</summary>
        
      
    
    
    
    <category term="博客" scheme="https://blog.felixchen0707.cn/categories/%E5%8D%9A%E5%AE%A2/"/>
    
    
    <category term="博客" scheme="https://blog.felixchen0707.cn/tags/%E5%8D%9A%E5%AE%A2/"/>
    
  </entry>
  
  <entry>
    <title>我的大一</title>
    <link href="https://blog.felixchen0707.cn/posts/dfa590a7/"/>
    <id>https://blog.felixchen0707.cn/posts/dfa590a7/</id>
    <published>2022-10-31T16:00:00.000Z</published>
    <updated>2022-10-31T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>可能是想利用闲下来的功夫哔哔点啥。</p><span id="more"></span><div class="tag-plugin quot"><h2 class="content" id="前言" type="icon"><a href="#前言" class="headerlink" title="前言"></a><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e07da3.png" />前言</h2></div><p>大一的生活比我想象的更快，加上一直不间断的疫情，大一后半段的生活似乎也就是在食堂和寝室两点一线中结束的。由于能看到这个博客的人要不就是在现实生活中与我毫无接触，要么就是无话不谈的好朋友，所以也不害怕暴露少部分的个人信息了。大一的各种琐事也都在最近渐渐收尾，不如自己来总结一下吧。</p><div class="tag-plugin quot"><h2 class="content" id="第一次早八" type="icon"><a href="#第一次早八" class="headerlink" title="第一次早八"></a><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e07da3.png" />第一次早八</h2></div><p>看到2022级同学入学时令我佩服的精气神，我也不由得想起自己刚进入大学时的样子。许多细节我其实也记不太得，但是印象深刻的还是开学的第一堂高数课。那是我的第一个早八。早上大概七点二十分左右，整整五百人的大教室就快坐满人了，现在想想这个点我刚醒吧（笑）。其实当时我也是这些疯狂的人之中的一员。说起动机，也未必是对知识的渴求，<strong>而是对新生活环境的好奇</strong>。毕竟在高中，可能一屁股坐在凳子上以后都不怎么离开位置吧，跟大学课间跑课不能说一模一样，就是毫不相关。坐在教室里，看着周围新奇的环境和陌生的课本，有一瞬间觉得高中所付出的辛苦都是值得的。不得不说，一个还算可以的高考成绩确实把我送进了理想的学府，让我感受到了梦寐以求的环境和氛围。虽然第一节高数课确实把我心态搞炸了，但是当时的我，确实表现出了前所未有的积极向上。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/10/31/RitJs.png" alt="我的高数破防时刻" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">我的高数破防时刻</span></div></div><div class="tag-plugin quot"><h2 class="content" id="专业预选" type="icon"><a href="#专业预选" class="headerlink" title="专业预选"></a><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e07da3.png" />专业预选</h2></div><p>出于某些懂的都懂的原因，我们学校对于工科专业是一起招收，入学后再进行二次分流。或许现在看来，这并不是什么稀奇事了，这种招生方式只会越来越广泛地被采取。但对于当时的我来说，简直就是噩梦。现在我依稀记得综评出分的那天晚上，我失眠了。我尽可能的从各种途径寻找能去<strong>信息安全</strong>的最低分数，甚至让原本不喜欢询问别人的我去加学长联系方式询问一些信息。其实我自己很清楚，这些努力基本上都是徒劳的，高考分数已然决定了我的去向，并不是我能够改变的。最后只能填了适合我这个分数段所能选择的我认为最有兴趣和前景的专业———生物医学工程。我记得很清楚，公布预选结果的时候我正在上大学化学这门课程，我整个暑假都在惦记的事情终于落地，似乎也没有那么焦虑和忧郁了。<strong>仔细想想我很多时候都是这个样子，其实很清楚自己的未来会朝着什么样的地方发展，但却依旧忧心忡忡。我并不害怕差的结果，但我害怕未知。</strong>不确定性是我一直很厌烦的事情。对于这个结果，后来我也很平静地接受了，虽然这本不是我最期望的结果。但站在现在的时间点，必须承认的是，我确实在生医工学院度过了值得我深深记住的大一学年。</p><div class="tag-plugin quot"><h2 class="content" id="大一下" type="icon"><a href="#大一下" class="headerlink" title="大一下"></a><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e07da3.png" />大一下</h2></div><p>虽然接受了分流结果，但我依然努力寻找进信安的方式，大二上的专业调整是我唯一的机会。经过大一上一学期的学习，我的年排最终锁定在8/80.这是一个还算不错的成绩，但对于转信安来说，还是有点痴人说梦了。但是大一下，我们有转出平台的机会，换句话说，就是可以离开工科平台，去学其他的专业。因为疫情，金融专业放弃了面试考察，转而采取更为简单粗暴的按排名由高到低录取。这对我来说是个不小的诱惑。<strong>当你无法选择自己喜欢的专业时，碰上宇宙金这个专业至少能保证不错的出路。</strong>而对于我的排名，被成功录取的概率是很大的。当时我便在转出或等待大二上两个选择中纠结，毕竟后者有赌的成分。这也就是我<ahref="/posts/b56d6855/">0624</a>这篇碎碎念的来源。如果将现在的我放在当时的情境下，即便过去五个多月，我依然不能给出准确的选择。但现在的我又很庆幸，当时的我没有因为眼前的另一条道路而选择退缩。<strong>在我看来，尝试后的失败比自我放弃的失败更加值得尊敬。</strong></p><div class="tag-plugin quot"><h2 class="content" id="我在生医工学联" type="icon"><a href="#我在生医工学联" class="headerlink" title="我在生医工学联"></a><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e07da3.png" />我在生医工学联</h2></div><p>整个大一的我基本都是围绕学积分在转，因此对于大学生活的多样和丰富我几乎没有什么感觉，反而是时常陷入焦虑的旋涡中。但唯一有一个选择是我从未后悔的，就是加入生医工的院学联。在这里，我真真切切感受到了社交间的温暖。许多人都曾在我面前抱怨过学生组织内部的腐烂，但对我而言，生医工学联带给我的是如同第二个家一般的温暖。由于院系小的缘故，学院每月都有固定的生日会，为当月生日的同学准备蛋糕；学联的同学们也经常性冒出很有想法的活动点子，使得我们学院看上去像是天天在搞活动；各部门内部的例会硬生生会被我们组织成团建的样子。诸如此类，还有很多。在这里，我确实认识了一帮很有意思的人们，以及很优秀的值得尊重的其他同学。<strong>我想如果有什么是让我依旧怀念的，生医工团学联可能占据了很大一部分。</strong></p><div class="tag-plugin quot"><h2 class="content" id="大一结束" type="icon"><a href="#大一结束" class="headerlink" title="大一结束"></a><img class="icon prefix" src="https://bu.dusays.com/2022/10/24/63567d3e07da3.png" />大一结束</h2></div><p>如今，虽然已经到了大二第一学期期中了，但我大一所担心的一切事物，都才刚刚结束。我达到了我一年前想都不敢想的高度，也为我日日胆战心惊所焦虑的事情交出了还算不错的答卷。我转去了我当初心心念念的信息安全，选拔上了金融的辅修，也在生医工的学联完成了我完完全全策划一场活动的梦想。我开始真正接触信息技术，我认识了一大批值得尊敬的同学，我遇上了不少我可能这辈子都不会忘记的教授。走上一个新的阶段，就意味着过去的一切已经被慢慢封存，而未来的路还等着我慢慢开辟。我可能会陷入新的痛苦，也有可能收获新的喜悦；我可能会受到挫折的历练，也可能体会到苦尽甘来的惊喜。不论如何，<strong>很多事都要我自己去闯。</strong></p><p><strong>未来的好坏我无法预知，但未来一直在我的手中。</strong></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;可能是想利用闲下来的功夫哔哔点啥。&lt;/p&gt;</summary>
    
    
    
    <category term="碎碎念" scheme="https://blog.felixchen0707.cn/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
    
    <category term="碎碎念" scheme="https://blog.felixchen0707.cn/tags/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
  </entry>
  
  <entry>
    <title>记录第一次手搓css</title>
    <link href="https://blog.felixchen0707.cn/posts/f6755936/"/>
    <id>https://blog.felixchen0707.cn/posts/f6755936/</id>
    <published>2022-10-16T06:24:34.000Z</published>
    <updated>2022-10-16T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>手搓一次css以后，最大的感受就是：再也不想写css了。</p><span id="more"></span><h2 id="起因">起因</h2><p>事情的起因是，<ahref="https://bowenyoung.cn/">Bowen</a>跟我说，他用tailwindcss重新写了个主页，后来效果确实不错。看了看自己的主页，感觉有点太花里胡哨了。<del>其实早些时候我特别喜欢花里胡哨，现在可能年纪大了吧。</del>后来看到了一位巨佬的主页，简洁得深得我心()。于是便仿照着极简的风格准备手搓。</p><h2 id="困难">困难</h2><p>遇到的困难是，我在这之前<emp>从来没有写过css</emp>。键盘上写下的每一行代码都是我最后的倔强。什么<code>margin</code>啊，<code>display</code>啊，彻底把我击垮了。问题在于，<strong>我甚至不能参考那位大佬的源码</strong>，用react写完生成的代码，甚至连一个css都没有。<span class="tag-plugin emoji"><img no-lazy="" class="inline" src="https://gcore.jsdelivr.net/gh/cdn-x/emoji/aru-l/11.gif"/></span>接着就是各种翻手册、一点点尝试、打开各种连接找各种可能的解决方法。终于做出了初版：</p><div class="tag-plugin image"><div class="image-bg"><img src="https://s1.xptou.com/2022/10/16/634bb7791d227.jpg" alt="初版效果" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">初版效果</span></div></div><p>事情本该到此结束了，这个风格好看也算不上，但说丑也不至于(?)。但在手机端这个效果真的是拉垮，后来才发现，我所有的宽度什么的设置全部用了<code>px</code>。<mark class="tag-plugin mark" color="red">大</mark><mark class="tag-plugin mark" color="red">寄</mark><mark class="tag-plugin mark" color="red">特</mark><mark class="tag-plugin mark" color="red">寄</mark>了属于是。</p><h2 id="后来">后来</h2><p>凌晨一点，揉着眼睛把css全部换了百分比，用Bowen的话说就是：</p><div class="tag-plugin quot"><p class="content" type="text">最简单的响应式</p></div><p>一想确实如此，低级是低级了点，反正一般人看前端也看不到我的代码(bushi)。</p><h2 id="结果">结果</h2><p>现在已经正式作为<ahref="https://i.felixchen0707.cn">个人主页</a>啦！感觉效果还不错，很干净。<psw>能力不支持复杂了</psw>不管怎么说也是第一次从零开始写css，还是比较满意的。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;手搓一次css以后，最大的感受就是：再也不想写css了。&lt;/p&gt;</summary>
    
    
    
    <category term="写码经历" scheme="https://blog.felixchen0707.cn/categories/%E5%86%99%E7%A0%81%E7%BB%8F%E5%8E%86/"/>
    
    
    <category term="css" scheme="https://blog.felixchen0707.cn/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>在django中实现websocket</title>
    <link href="https://blog.felixchen0707.cn/posts/79d21042/"/>
    <id>https://blog.felixchen0707.cn/posts/79d21042/</id>
    <published>2022-08-02T16:00:00.000Z</published>
    <updated>2022-08-02T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>本文在django中实现websocket协议。</p><span id="more"></span><h1 id="在django中使用websocket">在django中使用websocket</h1><p>  纯净的django是不支持websocket的，要想实现websocket协议，我们需要更改一些配置。</p><h2 id="step1-安装第三方包">Step1: 安装第三方包</h2><p>  第三方包<code>channels</code>提供了在django中实现websocket通信协议的方式。我们安装这个包：</p><div class="tag-plugin copy"><input class="copy-area" readonly id="copy_11" value="pip install channels"><button class="copy-btn" onclick="util.copy(&quot;copy_11&quot;,&quot;Copied!&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><p>然后，我们前往<code>settings.py</code>下注册这个app：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    &#x27;django.contrib.admin&#x27;,</span><br><span class="line">    &#x27;django.contrib.auth&#x27;,</span><br><span class="line">    &#x27;django.contrib.contenttypes&#x27;,</span><br><span class="line">    &#x27;django.contrib.sessions&#x27;,</span><br><span class="line">    &#x27;django.contrib.messages&#x27;,</span><br><span class="line"><span class="deletion">-    &#x27;django.contrib.staticfiles&#x27;</span></span><br><span class="line"><span class="addition">+    &#x27;django.contrib.staticfiles&#x27;,</span></span><br><span class="line"></span><br><span class="line">    # MyApp</span><br><span class="line"><span class="addition">+     &#x27;channels&#x27;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><strong>一定要注意这里的逗号，千万不要遗漏</strong>，否则django会将没有被逗号分隔开的两个应用视作一个应用。</p><h2 id="step2-配置asgi">Step2: 配置asgi</h2><p>  前往项目的<code>settings.py</code>下配置asgi：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WSGI_APPLICATION = &#x27;&#123;ProjectName&#125;.wsgi.application&#x27;</span><br><span class="line"><span class="addition">+ ASGI_APPLICATION = &#x27;&#123;ProjectName&#125;.asgi.application&#x27;</span></span><br></pre></td></tr></table></figure><p>然后前往<code>asgi.py</code>下更改默认配置，删除全部内容改写为：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ASGI config for Project0728 project.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">It exposes the ASGI callable as a module-level variable named ``application``.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">For more information on this file, see</span></span><br><span class="line"><span class="string">https://docs.djangoproject.com/en/4.0/howto/deployment/asgi/</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> django.core.asgi <span class="keyword">import</span> get_asgi_application</span><br><span class="line"><span class="keyword">from</span> channels.routing <span class="keyword">import</span> ProtocolTypeRouter, URLRouter</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> routings</span><br><span class="line"></span><br><span class="line">os.environ.setdefault(<span class="string">&#x27;DJANGO_SETTINGS_MODULE&#x27;</span>, <span class="string">&#x27;&#123;ProjectName&#125;.settings&#x27;</span>)</span><br><span class="line"></span><br><span class="line">application = ProtocolTypeRouter(&#123;</span><br><span class="line">    <span class="string">&quot;http&quot;</span>: get_asgi_application(),  <span class="comment"># http路由列表</span></span><br><span class="line">    <span class="string">&quot;websocket&quot;</span>: URLRouter(routings.websocket_urlpatterns),  <span class="comment"># websocket路由列表</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="step3-配置路由和视图类">Step3: 配置路由和视图类</h2><p>  在<code>settings.py</code>同级目录下新建<code>routings.py</code>，其功能相当于<code>urls.py</code>，专门负责websocket协议的路由：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">routings.py</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> &#123;应用名称&#125; <span class="keyword">import</span> consumers</span><br><span class="line"></span><br><span class="line">websocket_urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;&#123;URL&#125;&#x27;</span>, consumers.&#123;视图类&#125;.as_asgi()),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>  然后，前往需要使用到websocket的应用下新建<code>consumers.py</code>，其功能相当于<code>views.py</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> channels.generic.websocket <span class="keyword">import</span> WebsocketConsumer</span><br><span class="line"><span class="keyword">from</span> channels.exceptions <span class="keyword">import</span> StopConsumer</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> &#123;类名&#125;(WebsocketConsumer):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">websocket_connect</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="comment"># 客户端发来链接请求后自动执行</span></span><br><span class="line">        <span class="comment"># 允许创建链接</span></span><br><span class="line">        self.accept()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">websocket_receive</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="comment"># 客户端发来数据后自动执行</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">websocket_disconnect</span>(<span class="params">self, message</span>):</span><br><span class="line">        <span class="comment"># 客户端断开wb链接时自动触发</span></span><br><span class="line">        <span class="comment"># print(&quot;断开连接&quot;)</span></span><br><span class="line">        <span class="keyword">raise</span> StopConsumer()</span><br></pre></td></tr></table></figure><p>以上是默认的结构，当然，你可以在<code>routings.py</code>中配置多个路由，然后在<code>consumers.py</code>中声明多个类。</p><h2 id="运行程序并检查">运行程序并检查</h2><p>  此时我们运行程序，发现控制台输出变成了：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">August 02, 2022 - 16:12:48</span><br><span class="line">Django version 4.0.6, using settings &#x27;Project0728.settings&#x27;</span><br><span class="line">Starting ASGI/Channels version 3.0.5 development server at http://127.0.0.1:8000/</span><br><span class="line">Quit the server with CTRL-BREAK.</span><br></pre></td></tr></table></figure><p>说明此时django项目同时支持http协议和websocket协议了。</p><h1 id="前后端数据交互">前后端数据交互</h1><h2 id="后端">后端</h2><p>  后端对于websocket的操作相对较少，大多是对于数据的处理。主要用到的是<code>self.send()</code>和<code>self.close()</code>。</p><p>  <code>self.send()</code>，向建立连接的客户端发送数据，参数即为准备发送的数据。</p><p>  <code>self.close()</code>，服务端主动与客户端关闭连接。该函数被执行后，需要追加<code>return</code>停止函数继续运行。客户端接收到断开连接的请求后，客户端断开连接，同时，由于断开连接，服务端会自动执行<code>websocket_disconnect()</code>函数，然后抛出异常<code>StopConsumer()</code>，终止websocket连接。</p><h2 id="前端">前端</h2><h3 id="创建websocket连接">创建websocket连接</h3><p>  前端可以主动与目标url创建websocket连接。首先需要新建一个<code>WebSocket</code>对象，初始化参数是目标url。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;ws://127.0.0.1:8000/room/123/&quot;</span>);</span><br></pre></td></tr></table></figure><p>该请求匹配到后端的路由：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">&quot;room/&lt;int&gt;/&quot;</span>,consumers.ChatRoom.as_asgi())</span><br></pre></td></tr></table></figure><p>于是执行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">consumers.py</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChatRoom</span>(<span class="title class_ inherited__">WebsocketConsumer</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">websocket_connect</span>(<span class="params">self, message</span>):</span><br><span class="line">        self.accept()  <span class="comment"># 执行这句语句，即连接创建成功</span></span><br></pre></td></tr></table></figure><p>  此时，前端可以使用<code>ws.send()</code>发送数据了。</p><h3 id="回调函数">回调函数</h3><p>  当发生<strong>连接请求</strong>、<strong>传递数据</strong>、<strong>断开连接请求</strong>时，后端都有对应的函数会自动执行，前端也如此。这被称为<strong>回调函数</strong>。回调函数在满足条件后自动触发，JavaScript中可以为websocket绑定三种回调函数。</p><p>  如果<code>ws</code>是websocket的一个实例化对象，那么可以使用<code>ws.onopen</code>、<code>ws.onmessage</code>、<code>ws.onclose</code>绑定函数。例如：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ws.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">event</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> tag = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">    tag.<span class="property">innerText</span> = event.<span class="property">data</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;msg&quot;</span>).<span class="title function_">appendChild</span>(tag);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;已展示最新数据&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上述函数在后端主动发送数据后被自动执行，结果是向id为<code>msg</code>的块级内容写入新的元素。其中，<code>event</code>封装了后端发送的所有数据，利用<code>event.data</code>可以提取出数据。</p><p>  更多地，<code>onopen</code>发生在建立连接后，<code>onclose</code>发生在收到后端关闭连接请求后。</p><h1 id="多客户端的管理聊天室为例">多客户端的管理：聊天室为例</h1><h2 id="更改配置文件">更改配置文件</h2><p>  使用channel_layers，可以对同时连接的多个客户端进行管理。相关的数据需要被写入内存当中，因此需要在配置文件中添加：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">settings.py</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">CHANNEL_LAYERS = &#123;</span><br><span class="line">    <span class="string">&quot;default&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;BACKEND&quot;</span>: <span class="string">&quot;channels.layers.InMemoryChannelLayer&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="将新连接的客户端写入内存中">将新连接的客户端写入内存中</h2><p>  我们需要将新建立的连接写入内存。对实例对象调用<code>channel_layer.group_add()</code>方法。例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> asgiref.sync <span class="keyword">import</span> async_to_sync</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">websocket_connect</span>(<span class="params">self, message</span>):</span><br><span class="line">    <span class="comment"># 将连接加入组中，self.channel_name表示在该组中该连接的名称。</span></span><br><span class="line">    async_to_sync(self.channel_layer.group_add)(&#123;加入的组名&#125;, self.channel_name)</span><br></pre></td></tr></table></figure><p>其中，<strong>由于上述方法只支持异步，然而我们并没有编写异步代码，因此需要使用同步的方式完成该操作</strong>。<code>asnyc_to_sync</code>是将方法由异步转变成为同步。</p><p>  获得新消息时，对同一组内所有连接群发消息，可以使用<code>group_send()</code>完成。例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">websocket_message</span>(<span class="params">self, message</span>):</span><br><span class="line">    <span class="comment"># 对组名中所有连接对象调用方法名所对应的方法，字典作为参数传入</span></span><br><span class="line">    async_to_sync(self.channel_layer.group_send)(&#123;组名&#125;,&#123;<span class="string">&quot;type&quot;</span>: &#123;方法名&#125;,<span class="string">&quot;message&quot;</span>: message&#125;)</span><br></pre></td></tr></table></figure><p>如果方法定义为：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> &#123;方法名&#125;(self, event):</span><br><span class="line">    self.send(event[<span class="string">&#x27;message&#x27;</span>][<span class="string">&#x27;text&#x27;</span>])</span><br></pre></td></tr></table></figure><p>也就意味着对群组内所有连接都发送<code>message['text']</code>。</p><p>  断开连接时，需要从组内同时剔除该连接。可以使用：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">websocket_disconnect</span>(<span class="params">self, message</span>):</span><br><span class="line">    async_to_sync(self.channel_layer.group_discard)(&#123;组名&#125;, self.channel_name)</span><br></pre></td></tr></table></figure><p>这样，当连接终止时，自动触发<code>websocket_disconnect</code>，该连接就从group中被剔除了。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;本文在django中实现websocket协议。&lt;/p&gt;</summary>
    
    
    
    <category term="学习笔记" scheme="https://blog.felixchen0707.cn/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="django" scheme="https://blog.felixchen0707.cn/tags/django/"/>
    
    <category term="python" scheme="https://blog.felixchen0707.cn/tags/python/"/>
    
    <category term="websocket" scheme="https://blog.felixchen0707.cn/tags/websocket/"/>
    
  </entry>
  
  <entry>
    <title>django笔记(4)：为ModelForm表单添加样式、如何拼接GET参数</title>
    <link href="https://blog.felixchen0707.cn/posts/347baf21/"/>
    <id>https://blog.felixchen0707.cn/posts/347baf21/</id>
    <published>2022-07-31T16:00:00.000Z</published>
    <updated>2022-07-31T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>为django中的modelform添加样式。</p><span id="more"></span><h1 id="写在前面">写在前面</h1><p>  最近的开发学习碰到了两个比较重要的知识点：ModelForm表单和后端URL拼接。这两点不算太难但也比较复杂，并且在后续开发也很常用。<del>常不常用我不知道，反正我第一次是写懵了</del>所以在这里总结一下这部分知识点。</p><h1 id="正文">正文</h1><h2 id="modelform表单">ModelForm表单</h2><p>  得益于ModelForm表单，我们不必在前端写复杂的html代码来实现表单。我们只需要一个简单的循环，以及对每一个字段的引用就可以做到了：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">novalidate</span>&gt;</span></span><br><span class="line">    &#123;% csrf_token %&#125;</span><br><span class="line">    &#123;% for field in form %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;exampleInputEmail1&quot;</span>&gt;</span>&#123;&#123; field.label &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">            &#123;&#123;field&#125;&#125;</span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color: red&quot;</span>&gt;</span>&#123;&#123; field.errors.0 &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-success&quot;</span>&gt;</span>确认提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>  但是正是因为<code>input</code>框由django的ModelForm为我们自动生成，为其添加样式(例如BootStrap)就变得比较困难。在django中存在解决这个问题的途径。</p><h3id="第一种修改modelform类的widget属性">第一种：修改ModelForm类的widget属性</h3><p>  widget属性决定了每一个字段通过django渲染出的html代码格式。例如要为<code>username</code>字段添加<code>class="form-control"</code>的类名，那么我们就可以在定义ModelForm类时：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ExampleModelForm</span>(models.ModelForm):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Meta</span>:</span><br><span class="line">        model = models.Administrator</span><br><span class="line">        fields = [<span class="string">&quot;username&quot;</span>]</span><br><span class="line">        widgets = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: forms.CharField(attrs=&#123;<span class="string">&quot;class&quot;</span>:<span class="string">&quot;form-control&quot;</span>&#125;)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>  在字典中我们还可以添加其他键值关系，这样在前端渲染<code>input</code>时，就会带上我们所指定的<code>class="form-control"</code>。同样的，在widgets字典中还可以指定多个字段自己的widget属性。</p><p>  但是这样做会带来一个问题，例如我们对所有输入框都要应用BootStrap的样式，那么在widgets中逐个添加是否有些繁琐了呢？当然，我们也有办法解决这个问题。</p><h3 id="第二种重写__init__方法">第二种：重写__init__方法</h3><p>在创造这个<code>ExampleModelForm</code>类时，其存在默认的<code>__init__(self)</code>方法。我们重写这个方法。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BootStrapModelForm</span>(forms.ModelForm):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(*args, **kwargs)</span><br><span class="line">        <span class="comment"># 循环每个字段为其插件进行设置</span></span><br><span class="line">        <span class="keyword">for</span> name, field <span class="keyword">in</span> self.fields.items():</span><br><span class="line">            <span class="comment"># 字段中有属性，则增加</span></span><br><span class="line">            <span class="keyword">if</span> field.widget.attrs:</span><br><span class="line">                field.widget.attrs[<span class="string">&quot;class&quot;</span>] = <span class="string">&quot;form-control&quot;</span></span><br><span class="line">                field.widget.attrs[<span class="string">&quot;placeholder&quot;</span>] = field.label</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                field.widget.attrs = &#123;</span><br><span class="line">                    <span class="string">&quot;class&quot;</span>: <span class="string">&quot;form-control&quot;</span>,</span><br><span class="line">                    <span class="comment"># 还可以添加其他的标签，例如placeholder</span></span><br><span class="line">                    <span class="string">&quot;placeholder&quot;</span>: field.label</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure><p>  对上述代码做出一些解释。<code>super().__init__(*args,**kwargs)</code>是必须执行的，其初始化父类。然后，我们对存在的所有字段进行遍历，并对其中的<code>field</code>设置<code>widget</code>。其中，判断句<code>if</code>是为了防止覆盖原本的<code>attrs</code>属性。对于重写后的<code>__init__(self)</code>方法，我们可以单独将其作为一个父类，之后需要使用的所有ModelForm都改为继承此父类即可。</p><h2 id="拼接url">拼接URL</h2><p>  在访问url时，许多网站采用GET方式传参，这种参数一般显式地拼接在url后，例如</p><div class="tag-plugin note" ><div class="body"><p>https://127.0.0.1:8000/index/?page=4</p></div></div><p>在开发中，这样的参数可能不止一个，对于多个参数，在点击超链接时为了防止参数的损失，解决方式之一就是对超链接进行后端的拼接。django自然也支持这个操作。例如我们需要对上述url拼接一个<code>key=12</code>的参数使得其能够携带两个参数，我们首先要获取已有的参数。在访问url时，<code>request</code>变量会携带所有与这次url访问有关的信息，因此，我们要从这里动手脚。当然，出于保护机制，django不允许直接修改<code>request</code>的值，因此，我们需要拷贝一份。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">query_dict = copy.deepcopy(request.GET)</span><br></pre></td></tr></table></figure><p>  说明一下上一行代码：<code>request.GET</code>携带了以GET方式传递的所有参数，其类型是一个字典。然后，我们要对<code>query_dict</code>添加键值关系，<code>setlist()</code>方法支持这种操作。例如我们来添加<code>key=12</code>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">query_dict.setlist(<span class="string">&quot;key&quot;</span>, <span class="number">12</span>)</span><br></pre></td></tr></table></figure><p>  这样，新的键值关系就被我们添加完成了。此时<code>query_dict</code>的值应该是</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">query_dict = &#123;</span><br><span class="line">    <span class="string">&quot;page&quot;</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="string">&quot;key&quot;</span>: <span class="number">12</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>   最后，我们拼接url。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">url = <span class="string">&quot;https://127.0.0.1:8000/index/?&#123;&#125;&quot;</span>.<span class="built_in">format</span>(query_dict.urlencode())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(url)</span><br><span class="line"><span class="comment"># &quot;https://127.0.0.1:8000/index/?page=4&amp;key=12&quot;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;为django中的modelform添加样式。&lt;/p&gt;</summary>
    
    
    
    <category term="学习笔记" scheme="https://blog.felixchen0707.cn/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="django" scheme="https://blog.felixchen0707.cn/tags/django/"/>
    
    <category term="python" scheme="https://blog.felixchen0707.cn/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>快速生成requirements.txt</title>
    <link href="https://blog.felixchen0707.cn/posts/3c469774/"/>
    <id>https://blog.felixchen0707.cn/posts/3c469774/</id>
    <published>2022-07-28T16:00:00.000Z</published>
    <updated>2022-07-28T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言">前言</h1><p>  众所周知，Python的运行效率是不高的。但为什么Python还是很广泛地被使用呢？那当然是成熟的第三方库的加持！可以说Python的第三方库只有你想不到，没有他做不到的。因此，对于一个自己的或者是clone来的项目，下载依赖包就显得非常之重要。</p><h1 id="快速生成requirement.txt">快速生成requirement.txt</h1><p>  首先我们用包管理工具pip安装生成requirements.txt的插件。<div class="tag-plugin copy"><input class="copy-area" readonly id="copy_9" value="pip install pipreqs"><button class="copy-btn" onclick="util.copy(&quot;copy_9&quot;,&quot;Copied!&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div></p><p>  然后一行简单的命令就可以快速生成requirements.txt啦！ <div class="tag-plugin copy"><input class="copy-area" readonly id="copy_10" value="pipreqs . --encoding=utf-8 --force"><button class="copy-btn" onclick="util.copy(&quot;copy_10&quot;,&quot;Copied!&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div>  比起传统的<code>pip freeze &gt; requirement.txt</code>这句命令，上面可以做到虚拟环境之间相互隔离！也就是说，生成的requirements.txt只会包含当前项目用到的包，也很合常理对吧？</p><h1 id="偶尔水一水也不会有事的吧">偶尔水一水也不会有事的吧？</h1>]]></content>
    
    
    <summary type="html">两行命令快速生成项目的requirements.txt！</summary>
    
    
    
    <category term="编程技巧" scheme="https://blog.felixchen0707.cn/categories/%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A7/"/>
    
    
    <category term="Python" scheme="https://blog.felixchen0707.cn/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>django学习笔记(3)：models数据类型处理</title>
    <link href="https://blog.felixchen0707.cn/posts/f5da62aa/"/>
    <id>https://blog.felixchen0707.cn/posts/f5da62aa/</id>
    <published>2022-07-21T16:00:00.000Z</published>
    <updated>2022-07-21T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>如何在django中处理不同的数据类型？</p><span id="more"></span><h1 id="前言">前言</h1><p>  django通过继承<code>models</code>类来完成数据库表的创建，其中牵涉了很多数据类型和相关的知识点，这里把最近碰到的记录一下。</p><h1 id="django中数据类型的处理">Django中数据类型的处理</h1><p>  首先来看一下最近一个练手项目(用户管理系统)中基础的<strong>部门表</strong>和<strong>用户表</strong>的定义。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 员工管理系统</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Department</span>(models.Model):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;这是部门的表：id, title&quot;&quot;&quot;</span></span><br><span class="line">    title = models.CharField(verbose_name=<span class="string">&#x27;标题&#x27;</span>, max_length=<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInfo</span>(models.Model):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;员工表&quot;&quot;&quot;</span></span><br><span class="line">    name = models.CharField(verbose_name=<span class="string">&#x27;姓名&#x27;</span>, max_length=<span class="number">16</span>)</span><br><span class="line">    password = models.CharField(verbose_name=<span class="string">&#x27;密码&#x27;</span>, max_length=<span class="number">64</span>)</span><br><span class="line">    age = models.IntegerField(verbose_name=<span class="string">&#x27;年龄&#x27;</span>)</span><br><span class="line">    account = models.DecimalField(verbose_name=<span class="string">&#x27;账户余额&#x27;</span>, max_digits=<span class="number">10</span>,</span><br><span class="line">                                  decimal_places=<span class="number">2</span>, default=<span class="number">0</span>)</span><br><span class="line">    create_time = models.DateTimeField(verbose_name=<span class="string">&#x27;入职时间&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    depart = models.ForeignKey(to=<span class="string">&quot;Department&quot;</span>, to_field=<span class="string">&quot;id&quot;</span>, on_delete=models.CASCADE) </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 性别选项</span></span><br><span class="line">    gender_choices = (</span><br><span class="line">        (<span class="number">1</span>, <span class="string">&quot;男&quot;</span>),</span><br><span class="line">        (<span class="number">2</span>, <span class="string">&quot;女&quot;</span>),</span><br><span class="line">    )</span><br><span class="line">    gender = models.SmallIntegerField(verbose_name=<span class="string">&quot;性别&quot;</span>, choices=gender_choices)</span><br></pre></td></tr></table></figure></p><p>  针对上面出现的类型，这里做一些相应地解释。</p><h2 id="charfield">CharField</h2><p>  <code>CharField</code>是基础的字符串类型，上述案例中，<code>verbose_name=</code>参数在许多函数中都出现了，实际上，这个参数主要是便于开发者自己了解每一个字段代表什么含义，由于我们是Django开发，因此我们使用注释的方案也可以，具体看个人喜好。对于CharField来说，<code>max_length=</code>是必要的，因为在创建MySQL表时，我们需要指定每一个<code>varchar</code>的字节数。</p><h2 id="decimalfield">DecimalField</h2><p>  是Python中十进制浮点数的实例。上述例子中含有两个参数，<code>max_digits=</code>表示数字位数，这是<strong>同时包含整数部分和小数部分的位数</strong>。<code>decimal_places=</code>表示小数位数。<code>default=</code>用于在使用<code>UserInfo.objects.create()</code>时没有指定<code>account</code>参数值的时候的默认值。</p><h2 id="datetimefield">DateTimeField</h2><p>  <code>DateTimeField</code>是专门存储时间的字段类型，格式为<code>Y-m-d H:m:s</code>。当我们要输出这个值时，我们通常要先对其进行格式化。我们使用<code>strftime(&#123;format&#125;)</code>来达到这个目的。format的格式包含以下多种选择。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">%y 两位数的年份表示（00-99）</span><br><span class="line">%Y 四位数的年份表示（000-9999）</span><br><span class="line">%m 月份（01-12）</span><br><span class="line">%d 月内中的一天（0-31）</span><br><span class="line">%H 24小时制小时数（0-23）</span><br><span class="line">%I 12小时制小时数（01-12）</span><br><span class="line">%M 分钟数（00=59）</span><br><span class="line">%S 秒（00-59）</span><br><span class="line">%a 本地简化星期名称</span><br><span class="line">%A 本地完整星期名称</span><br><span class="line">%b 本地简化的月份名称</span><br><span class="line">%B 本地完整的月份名称</span><br><span class="line">%c 本地相应的日期表示和时间表示</span><br><span class="line">%j 年内的一天（001-366）</span><br><span class="line">%p 本地A.M.或P.M.的等价符</span><br><span class="line">%U 一年中的星期数（00-53）星期天为星期的开始</span><br><span class="line">%w 星期（0-6），星期天为星期的开始</span><br><span class="line">%W 一年中的星期数（00-53）星期一为星期的开始</span><br><span class="line">%x 本地相应的日期表示</span><br><span class="line">%X 本地相应的时间表示</span><br><span class="line">%Z 当前时区的名称</span><br><span class="line">%% %号本身</span><br></pre></td></tr></table></figure> 当然，我们最常用的还是 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">time.strftime(<span class="string">&quot;%Y-%m-%d %H:%m:%s&quot;</span>)  <span class="comment"># 精确到秒的时间记录</span></span><br><span class="line">time.strftime(<span class="string">&quot;%Y-%m-%d&quot;</span>)  <span class="comment"># 精确到日期的时间记录</span></span><br></pre></td></tr></table></figure></p><p>  在Django模板语法中，一般是不允许出现括号的。在前端页面，我们需要改写成<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; time|date:&quot;Y-m-d&quot; &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>在Pycharm中按住<kbd>Ctrl</kbd>查看上述案例中<code>date</code>的源码，可以发现其也是一个函数，只不过使用了特殊的<code>|</code>符号表示而已。</p><h2 id="foreignkey">ForeignKey</h2><p>  <code>ForeignKey</code>表示的是外键，也就是将表与表之间建立联系的一种方式。在上述案例中，由于我们需要知晓员工的所属部门，因此我们使用外键将<code>depart</code>字段与<code>Department</code>中的<code>id</code>字段相关联。在Django自动生成表的时候，<code>depart</code>字段会被命名成<code>depart_id</code>。使用<code>ForeignKey</code>的时候，我们需要指定参数<code>to=</code>和<code>to_field=</code>，前者指定与哪张表关联，后者指定关联的字段名。当然了，由于关联的原因，我们还需要指定<code>on_delete=</code>，这个参数指定当<code>Department</code>表中的数据删除时，<code>UserInfo</code>中对应这些数据的记录将要如何操作。<code>models.CASCADE</code>表示<strong>级联删除</strong>，即<strong>删除所有与被删除数据相关联的记录</strong>；还可以选择<code>models.SET_NULL</code>，这样所有关联数据的该字段将会被<strong>置空</strong>。但这有一个前提，你需要在参数列表指定该字段可以为空，即<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">department = models.ForeignKey(to=<span class="string">&quot;Department&quot;</span>, to_field=<span class="string">&quot;id&quot;</span>, null=<span class="literal">True</span>, blank=<span class="literal">True</span>, on_delete=models.SET_NULL)</span><br></pre></td></tr></table></figure></p><p>  在读取数据中，我们需要先获取<code>UserInfo</code>的记录，再通过外链访问<code>Department</code>，即<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">obj = models.UserInfo.objects.fileter(&#123;筛选条件&#125;).first()  <span class="comment"># 获取满足筛选条件的第一个对象</span></span><br><span class="line"><span class="built_in">print</span>(obj.depart_id)  <span class="comment"># 访问obj.depart_id，我们得到的是部门id</span></span><br><span class="line">title = models.Department.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=obj.depart_id).first().title  <span class="comment"># 再次筛选，取出title字段才是我们要的部门名称</span></span><br><span class="line"></span><br><span class="line">title = models.Department.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=models.UserInfo.objects.<span class="built_in">filter</span>(&#123;筛选条件&#125;).first().depart_id).first().title</span><br><span class="line"><span class="comment"># 合并上述语句我们得到非常之长的一句数据库查询语句</span></span><br></pre></td></tr></table></figure>显然，这句语句太长了，Django提供了另一种通过外键查询另一张表的方式，在上述例子中<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">obj = models.UserInfo.objects.fileter(&#123;筛选条件&#125;).first()  <span class="comment"># 获取满足筛选条件的第一个对象</span></span><br><span class="line"><span class="built_in">print</span>(obj.depart.title)  <span class="comment"># 这时直接输出了部门名字</span></span><br></pre></td></tr></table></figure>在这种书写方式下，<code>obj.depart</code>直接返回根据<code>depart_id</code>查询到的第一个<code>object</code>。由于我们这个案例中ID值唯一，于是直接访问其<code>.title</code>即可。</p><p>  于是在前端页面，我们可以通过如下的模板语法访问每一个人对应的部门的名称：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">&#123;% for obj in userinfo_list %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; obj.name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; obj.depart.title &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="smallintegerfield">SmallIntegerField</h2><p>  该数据类型常应用于固定的枚举型，例如上例中的性别。在绝大多数情况下，性别是不会继续添加的，因此我们可以用元组的嵌套来指定这种对应关系：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gender_choices=(</span><br><span class="line">    (<span class="number">1</span>, <span class="string">&quot;男&quot;</span>),</span><br><span class="line">    (<span class="number">2</span>, <span class="string">&quot;女&quot;</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>相比于存储汉字，在数据库中存储短整型占用更少的存储空间。这种情况下，你需要为<code>SmallIntegerField</code>指定参数<code>choices=</code>。这个参数接受一个嵌套元组用来指定对应关系。</p><p>  当然，这会带来一个问题，我们访问<code>obj.gender</code>时，会输出整型而非我们想要的汉字“男”或“女”，同样的，Django提供了一个函数：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">obj.get_gender_display()  <span class="comment"># 这个函数名称会随着你对字段名命名的不同而变化</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 命名规则</span></span><br><span class="line">obj.get_&#123;字段名称&#125;_display()</span><br></pre></td></tr></table></figure></p><p>  在前端页面，你可以使用模板语法来完成这个功能： <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; obj.get_gender_display &#125;&#125;</span><br></pre></td></tr></table></figure>需要注意的是：<strong>你依然不需要在函数末尾添加括号。</strong></p><h1 id="django的html模板">Django的html模板</h1><div class="tag-plugin note" color="blue"><div class="body"><p>这部分不是本文的重点，但也是Django开发中十分重要的一部分，其可以大大增加代码复用率。因此也一并写在这里。</p></div></div><p>  很多时候，许多HTML文件都具备一部分的相同结构，例如，所有页面都有页面顶部的导航栏(navigationbar)，都需要引入相同的css和js等文件。Django提供模板页面来解决这个问题。我们只需要在模板文件中需要被插入的结构加入：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--省略以上html内容--&gt;</span></span><br><span class="line"></span><br><span class="line">    &#123;% block &#123;板块名称&#125; %&#125;</span><br><span class="line">    &#123;% endblock %&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--省略以下html内容--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>然后再需要使用的页面引入该模板即可，如果模板名称为<code>layout.html</code>，那么就可以写成这样：<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &#x27;layout.html&#x27; %&#125;</span><br><span class="line">&#123;% block &#123;模块名称&#125; %&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--这里是你的html--&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>渲染该页面时，Django会自动将其与模板<code>layout.html</code>拼接。一个模板中可以有多个这样的结构，一个HTML文件中也可以由多个这样的结构组成。</p><h1 id="后记">后记</h1><p>  这篇文章字不多，但干货占比也挺高的。赶紧写出来也是方便我后续复习和查询使用。<del>所以就浅浅地日更了一下。</del>那这篇文章就到此结束吧！该休息咯。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;如何在django中处理不同的数据类型？&lt;/p&gt;</summary>
    
    
    
    <category term="学习笔记" scheme="https://blog.felixchen0707.cn/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="django" scheme="https://blog.felixchen0707.cn/tags/django/"/>
    
    <category term="python" scheme="https://blog.felixchen0707.cn/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>django学习笔记(2)：操作MySQL数据库</title>
    <link href="https://blog.felixchen0707.cn/posts/a907f775/"/>
    <id>https://blog.felixchen0707.cn/posts/a907f775/</id>
    <published>2022-07-20T16:00:00.000Z</published>
    <updated>2022-07-20T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>使用django操作mysql数据库。</p><span id="more"></span><h1 id="前言">前言</h1><p>  数据库是web应用中很重要的组成部分之一。Django框架自带了sqlite3数据库，然而在使用的广泛程度上，MySQL的应用场景更加多。本篇主要解释如何将数据库换成MySQL，以及一些基本用法。</p><h1 id="更换默认数据库为mysql">更换默认数据库为MySQL</h1><h2 id="创建数据库">创建数据库</h2><p>  由于django的orm只能完成对于表的操作，因此数据库的创建需要我们自行完成，这里以本地MySQL数据库为例。在MySQL终端输入</p><div class="tag-plugin copy"><input class="copy-area" readonly id="copy_4" value="create database {数据库名} DEFAULT CHARSET utf8 COLLATE utf8_general_ci;"><button class="copy-btn" onclick="util.copy(&quot;copy_4&quot;,&quot;Copied!&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><p>完成数据库的创建。然后运行 <code>use &#123;db_name&#125;</code> ，若提示为emptyset（空的数据库），则创建成功。</p><h2 id="安装第三方依赖">安装第三方依赖</h2><p>  首先我们需要安装第三方包 <code>pymysql</code>（你也可以使用<code>mysqlclient</code>），这个第三方包能够帮助Django完成对MySQL数据库的增删改查操作，</p><div class="tag-plugin copy"><input class="copy-area" readonly id="copy_5" value="pip install pymysql"><button class="copy-btn" onclick="util.copy(&quot;copy_5&quot;,&quot;Copied!&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><div class="tag-plugin note" color="blue"><div class="body"><p>如果安装缓慢，可以参考本系列的第一篇文章，将安装源换成国内镜像站。</p></div></div><h2 id="更改项目配置文件">更改项目配置文件</h2><p>  在项目目录下找到<code>setting.py</code>，找到<code>DATABASES</code>，这里默认是</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.sqlite3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: BASE_DIR / <span class="string">&#x27;db.sqlite3&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中， <code>ENGINE</code> 指明了数据库类型， <code>NAME</code>指明了数据库名称。默认情况下，Django使用内部集成的sqlite3.我们修改之，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>: <span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>: <span class="string">&#x27;webapp&#x27;</span>,  <span class="comment"># 数据库名字</span></span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>: <span class="string">&#x27;&#123;你的密码&#125;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,  <span class="comment"># MySQL在哪个ip</span></span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>: <span class="string">&#x27;3306&#x27;</span>,  <span class="comment"># 端口号</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中，<code>HOST</code>是主机ip，这里使用的是本地，因此是<code>127.0.0.1</code>，<code>PORT</code>是端口号，本地MySQL的端口号是<code>3306</code>。然后，你需要在项目的<code>_init_.py</code>中添加：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure><h1 id="使用django操作mysql的表">使用Django操作MySQL的表</h1><h2 id="创建表">创建表</h2><p>  表的操作都可以用python语法完成，其中orm会将其翻译成SQL语句，对于我们来说，无需自己再写SQL语句了。</p><p>  在<strong>已注册的应用</strong>下的<code>models.py</code>中新建类，例如我们要创建一个用户信息的表，那么我们可以写成</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserInfo</span>(models.Model):</span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    password = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">    age = models.IntegerField(default=<span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>然后，我们在终端运行</p><div class="tag-plugin copy"><input class="copy-area" readonly id="copy_6" value="python manage.py makemigrations && python manage.py migrate"><button class="copy-btn" onclick="util.copy(&quot;copy_6&quot;,&quot;Copied!&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><p>这时，Django自动为我们创建了表，其相当于</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> app01_userinfo(</span><br><span class="line">    id <span class="type">bigint</span> auto_increment <span class="keyword">primary</span> key,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">32</span>),</span><br><span class="line">    password <span class="type">varchar</span>(<span class="number">64</span>),</span><br><span class="line">    age <span class="type">int</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>在MySQL终端输入</p><div class="tag-plugin copy"><input class="copy-area" readonly id="copy_7" value="show tables;"><button class="copy-btn" onclick="util.copy(&quot;copy_7&quot;,&quot;Copied!&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><p>终端输出</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br><span class="line">+----------------------------+</span><br><span class="line">| Tables_in_webapp           |</span><br><span class="line">+----------------------------+</span><br><span class="line">| app01_userinfo             |</span><br><span class="line">| auth_group                 |</span><br><span class="line">| auth_group_permissions     |</span><br><span class="line">| auth_permission            |</span><br><span class="line">| auth_user                  |</span><br><span class="line">| auth_user_groups           |</span><br><span class="line">| auth_user_user_permissions |</span><br><span class="line">| django_admin_log           |</span><br><span class="line">| django_content_type        |</span><br><span class="line">| django_migrations          |</span><br><span class="line">| django_session             |</span><br><span class="line">+----------------------------+</span><br><span class="line">11 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>这表明，<code>app01_userinfo</code>的表已经被创建。当然，这里其他的表示Django内部的其他类，我们这里无需在意。接下来我们检查字段。MySQL终端输入</p><div class="tag-plugin copy"><input class="copy-area" readonly id="copy_8" value="desc app01_userinfo;"><button class="copy-btn" onclick="util.copy(&quot;copy_8&quot;,&quot;Copied!&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><p>观察到输出</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; desc app01_userinfo;</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line">| Field    | Type        | Null | Key | Default | Extra          |</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line">| id       | bigint      | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| name     | varchar(32) | NO   |     | NULL    |                |</span><br><span class="line">| password | varchar(64) | NO   |     | NULL    |                |</span><br><span class="line">| age      | int         | NO   |     | NULL    |                |</span><br><span class="line">+----------+-------------+------+-----+---------+----------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>其中，<code>name</code>，<code>password</code>和<code>age</code>都是我们所定义的字段，<code>id</code>是Django自动创建的字段。</p><h2 id="修改表">修改表</h2><p>  当然，我们也免不了修改表的字段数，例如，我们不需要<code>age</code>这一个字段了，我们只需要在<code>models.py</code>下删除之。</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line">class UserInfo(models.Model):</span><br><span class="line">    name = models.CharField(max_length=32)</span><br><span class="line">    password = models.CharField(max_length=64)</span><br><span class="line"><span class="deletion">-   age = models.IntegerField(default=0)</span></span><br></pre></td></tr></table></figure><p>然后重新在终端执行<code>makemigrations</code>和<code>migrate</code>二连，我们就可以观察到这一字段消失了。</p><p>  有时候，我们也会为表中新增字段，例如：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line"></span><br><span class="line">class UserInfo(models.Model):</span><br><span class="line">    name = models.CharField(max_length=32)</span><br><span class="line">    password = models.CharField(max_length=64)</span><br><span class="line">    age = models.IntegerField(default=0)</span><br><span class="line"><span class="addition">+   sex = models.CharField(max_length=4)</span></span><br></pre></td></tr></table></figure><p>执行数据迁移二连，我们会发现控制台有警报。</p><figure><img src="https://i.imgtg.com/2022/07/20/rovbC.jpg" alt="控制台警报" /><figcaption aria-hidden="true">控制台警报</figcaption></figure><p>这是因为，当我们添加字段时，如果表中有数据，那么这些数据的新字段的值我们就不得而知。因此，会产生上述的告警。控制台给了我们两种解决方式：</p><ol type="1"><li>为已有的数据分配初始值来填补这些空缺；</li><li>在<code>models.py</code>中声明初始值。</li></ol><p>对于选择1，我们可以将已有的数据的该字段的值赋值成为我们指定的值，这里不多说了。对于选择2，则需要为该字段指定默认值，那么上述语句可以被重写成</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class UserInfo(models.Model):</span><br><span class="line">    name = models.CharField(max_length=32)</span><br><span class="line">    password = models.CharField(max_length=64)</span><br><span class="line">    age = models.IntegerField(default=0)</span><br><span class="line"><span class="deletion">-   sex = models.CharField(max_length=4)</span></span><br><span class="line"><span class="addition">+   sex = models.CharField(max_length=4, default=&#x27;male&#x27;)</span></span><br></pre></td></tr></table></figure><p>于是，控制台告警消失，并且之前所有已存在的数据的新字段都被赋值为初始值。当然了，你也可以声明该字段允许为空，例如：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class UserInfo(models.Model):</span><br><span class="line">    name = models.CharField(max_length=32)</span><br><span class="line">    password = models.CharField(max_length=64)</span><br><span class="line">    age = models.IntegerField(default=0)</span><br><span class="line"><span class="deletion">-   sex = models.CharField(max_length=4, default=&#x27;male&#x27;)</span></span><br><span class="line"><span class="addition">+   sex = models.CharField(max_length=4,blank=True,null=True)</span></span><br></pre></td></tr></table></figure><p>这样也是可以的。</p><h1 id="使用django操作mysql中的数据">使用Django操作MySQL中的数据</h1><p>  我们依然可以用python语句来操作MySQL中的数据。</p><h2 id="创建数据">创建数据</h2><p>  创建数据的语法是：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;类名&#125;.objects.create(参数列表)</span><br></pre></td></tr></table></figure><p>例如我们需要在<code>app01_userinfo</code>中插入一段记录，以下就是一个例子：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UserInfo.objects.create(name=<span class="string">&quot;Felix&quot;</span>, password=<span class="string">&quot;123&quot;</span>, age=<span class="number">19</span>)</span><br></pre></td></tr></table></figure><p>这句python会被orm翻译成SQL语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> app01_userinfo(name, password, age)<span class="keyword">value</span>(&quot;Felix&quot;, &quot;123&quot;, <span class="number">19</span>)</span><br></pre></td></tr></table></figure><h2 id="删除数据">删除数据</h2><p>  删除数据的语法是：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;类名&#125;.objects.<span class="built_in">filter</span>(筛选条件).delete()</span><br></pre></td></tr></table></figure><p>如果你要清空数据，那么可以写成</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;类名&#125;.objects.<span class="built_in">all</span>().delete()</span><br></pre></td></tr></table></figure><p>当然，过滤函数还有许多写法，这里只展示了<code>filter()</code>和<code>all()</code>。</p><h2 id="查找数据">查找数据</h2><p>  查找数据的语法是</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;类名&#125;.objects.<span class="built_in">filter</span>(筛选条件)</span><br></pre></td></tr></table></figure><p>函数的返回值是一个<code>QuerySet</code>类型，在python中，其可以被理解成<strong>结构体对象的列表</strong>，例如</p><div class="tag-plugin note" ><div class="body"><p>[&lt;UserInfo: UserInfo object (1)&gt;, &lt;UserInfo: UserInfo object(2)&gt;, &lt;UserInfo: UserInfo object (3)&gt;]</p></div></div><p>如果我们要读取其内部值，就可以用简单的python语法实现，这里举个例子：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">user_info_list = UserInfo.objects.<span class="built_in">all</span>()</span><br><span class="line"><span class="keyword">for</span> obj <span class="keyword">in</span> user_info_list:</span><br><span class="line">    <span class="built_in">print</span>(obj.<span class="built_in">id</span>, obj.name, obj.password, obj.age)</span><br></pre></td></tr></table></figure><p>当然，如果我们明确知道表中只有一行数据，那么我们可以避免使用循环，直接用</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obj = UserInfo.objects.<span class="built_in">all</span>().first()</span><br></pre></td></tr></table></figure><p>获取对象即可。</p><h2 id="更新数据">更新数据</h2><p>  更新数据，首先要找到需要更新的记录，因此，前一部分与查找是很相似的。<code>update()</code>函数完成后续的更新操作，例如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UserInfo.objects.<span class="built_in">filter</span>(<span class="built_in">id</span>=<span class="number">2</span>).update(password = <span class="string">&quot;999&quot;</span>)</span><br></pre></td></tr></table></figure><p>则被筛选出的记录的<code>password</code>字段都会被更新成<code>999</code>。</p><h1 id="后记">后记</h1><p>  有了与数据库的联动操作，我们已经可以写一些基础的业务逻辑了。当然，Django对于数据库的操作远不止这些。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;使用django操作mysql数据库。&lt;/p&gt;</summary>
    
    
    
    <category term="学习笔记" scheme="https://blog.felixchen0707.cn/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="django" scheme="https://blog.felixchen0707.cn/tags/django/"/>
    
    <category term="python" scheme="https://blog.felixchen0707.cn/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>django学习笔记(1)：Django的安装与准备</title>
    <link href="https://blog.felixchen0707.cn/posts/357997ca/"/>
    <id>https://blog.felixchen0707.cn/posts/357997ca/</id>
    <published>2022-07-17T16:00:00.000Z</published>
    <updated>2022-07-17T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>开一个新坑，django开发。</p><span id="more"></span><h1 id="django介绍">Django介绍</h1><p>  Django是一个开放源代码的Web应用框架，由Python写成。利用Django和相关的html和CSS知识，我们可以轻松构建出一个简单的网站。本文主要介绍使用Django的一些准备工作。</p><h1 id="安装django">安装Django</h1><p>  首先，你需要Python环境。这里以Python3环境为例。安装有两种方式：<strong>命令行安装</strong>和<strong>使用开发软件Pycharm</strong>。</p><div class="tag-plugin tabs" align="center"id="tab_1"><div class="nav-tabs"><div class="tab active"><a href="#tab_1-1">使用命令行</a></div><div class="tab"><a href="#tab_1-2">Pycharm中使用</a></div></div><div class="tab-content"><div class="tab-pane active" id="tab_1-1"><p>  这里以Linux操作系统为例。首先打开命令行窗口，建立虚拟环境。</p><div class="tag-plugin copy"><input class="copy-area" readonly id="copy_1" value="python -m venv ll_env"><button class="copy-btn" onclick="util.copy(&quot;copy_1&quot;,&quot;Copied!&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><p>而后激活此虚拟环境。</p><div class="tag-plugin copy"><input class="copy-area" readonly id="copy_2" value="source ll_env/bin/activate"><button class="copy-btn" onclick="util.copy(&quot;copy_2&quot;,&quot;Copied!&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><p>如果想要停止此虚拟环境，你可以使用<code>deactivate</code>来关闭之。然后我们来下载Django。</p><div class="tag-plugin copy"><input class="copy-area" readonly id="copy_3" value="pip install Django"><button class="copy-btn" onclick="util.copy(&quot;copy_3&quot;,&quot;Copied!&quot;)"><svg class="icon copy-btn" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5.75 1a.75.75 0 00-.75.75v3c0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75v-3a.75.75 0 00-.75-.75h-4.5zm.75 3V2.5h3V4h-3zm-2.874-.467a.75.75 0 00-.752-1.298A1.75 1.75 0 002 3.75v9.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 13.25v-9.5a1.75 1.75 0 00-.874-1.515.75.75 0 10-.752 1.298.25.25 0 01.126.217v9.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-9.5a.25.25 0 01.126-.217z"></path></svg></button></div><div class="tag-plugin note" color="color"><div class="title"><strong>注意</strong></div><div class="body"><p>如果下载速度很慢，你可以尝试更换成国内镜像源。例如<code>pip installDjango -i https://pypi.tuna.tsinghua.edu.cn/simple</code>+清华：https://pypi.tuna.tsinghua.edu.cn/simple+阿里云：http://mirrors.aliyun.com/pypi/simple/ +中国科技大学https://pypi.mirrors.ustc.edu.cn/simple/+华中理工大学：http://pypi.hustunique.com/+山东理工大学：http://pypi.sdutlinux.org/+豆瓣：http://pypi.douban.com/simple/</p></div></div></div><div class="tab-pane" id="tab_1-2"><p>Pycharm中的使用相对而言简单许多。在项目文件下新建项目，而后在<u>文件-&gt;设置-&gt;项目-&gt;Python解释器</u>中安装Django即可。</p></div></div></div><h1 id="开始使用django">开始使用Django</h1><h2 id="新建django项目">新建Django项目</h2><p>  下载完Django库后，我们需要在我们的项目文件夹中新建一个Django项目，这将告诉Django，这不是一个纯Python项目。首先我们在Pycharm的终端或者命令行窗口运行以下指令：<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin startproject &lt;projectname&gt; .</span><br></pre></td></tr></table></figure> 其中，<code>&lt;projectname&gt;</code>是项目名称。<div class="tag-plugin note" color="blue"><div class="title">如果你使用的是Pycharm</div><div class="body"><p>ProfessionalEdition，那么你可以直接在创建项目之初就创建Django项目，而无需上述的多步操作。但需要注意，在项目的<code>setting.py</code>中<code>TEMPLATES</code>中第一个字典的键<code>DIRS</code>存在<code>[os.path.join(BASE_DIR, templates)]</code>，它将影响静态文件查找位置，最好删去。</p></div></div> <div class="tag-plugin note" color="red"><div class="body"><p>注意，上述的命令语句千万不要忘记末尾的<code>.</code>。遗漏了这个句点将在后续项目部署上需要额外的复杂操作。</p></div></div></p><p>  最后运行<code>python manage.py runserver</code>，检查Django是否能正确运行。若可以，则初步配置成功。</p><h2 id="django项目中的文件结构">Django项目中的文件结构</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;projectname&gt;</span><br><span class="line">├─manage.py       【项目管理、启动项目、创建应用、数据管理】【无需更改】</span><br><span class="line">│  </span><br><span class="line">└─&lt;projectname&gt;</span><br><span class="line">   ├─__init__.py</span><br><span class="line">   ├─settings.py  【项目配置文件】【例如注册应用、链接数据库】</span><br><span class="line">   ├─urls.py      【url和函数对应关系】【主要编写的部分】</span><br><span class="line">   ├─asgi.py      【接收网络请求】【无需更改】</span><br><span class="line">   └─vsgi.py      【接收网络请求】【无需更改】</span><br></pre></td></tr></table></figure><h2 id="新建应用">新建应用</h2><p>  根据项目的业务逻辑，我们将其分为多个应用来分开管理。我们先新建第一个应用，在终端输入命令<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py startapp &lt;appname&gt;</span><br></pre></td></tr></table></figure> 于是我们得到这样的目录。 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;projectname&gt;</span><br><span class="line">├─manage.py       【项目管理、启动项目、创建应用、数据管理】【无需更改】</span><br><span class="line">│</span><br><span class="line">├─&lt;appname&gt;</span><br><span class="line">|  ├─__init__.py</span><br><span class="line">|  ├─admin.py     【后台管理界面】</span><br><span class="line">|  ├─apps.py      【启动类】</span><br><span class="line">|  ├─models.py    【在数据库中创建对应表】</span><br><span class="line">|  ├─tests.py     【测试类】</span><br><span class="line">|  ├─views.py     【函数】</span><br><span class="line">|  └─migrations   【数据库迁移记录】</span><br><span class="line">|       └─__init__.py</span><br><span class="line">|  </span><br><span class="line">└─&lt;projectname&gt;</span><br><span class="line">   ├─__init__.py</span><br><span class="line">   ├─settings.py  【项目配置文件】【例如注册应用、链接数据库】</span><br><span class="line">   ├─urls.py      【url和函数对应关系】【主要编写的部分】</span><br><span class="line">   ├─asgi.py      【接收网络请求】【无需更改】</span><br><span class="line">   └─vsgi.py      【接收网络请求】【无需更改】</span><br></pre></td></tr></table></figure></p><p>  新建应用后，我们需要对其<strong>注册</strong>。我们找到应用下的<code>apps.py</code>，找到其启动类类名，以下是一个例子。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># filename: apps.py</span></span><br><span class="line"><span class="keyword">from</span> django.apps <span class="keyword">import</span> AppConfig</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App01Config</span>(<span class="title class_ inherited__">AppConfig</span>):</span><br><span class="line">    default_auto_field = <span class="string">&#x27;django.db.models.BigAutoField&#x27;</span></span><br><span class="line">    name = <span class="string">&#x27;app01&#x27;</span></span><br></pre></td></tr></table></figure> 于是我们修改<code>settings.py</code>中的内容：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># filename: settings.py</span></span><br><span class="line"><span class="comment"># 省略</span></span><br><span class="line"></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="comment"># 省略</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;&lt;appname&gt;.apps.APP01Config&#x27;</span>,</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">#省略</span></span><br></pre></td></tr></table></figure> 于是，新的应用已经注册完毕，我们可以在该应用上开发了。</p>]]></content>
    
    
    <summary type="html">django是一款基于python的网站开发工具。本文主要介绍Django的安装与使用前准备。</summary>
    
    
    
    <category term="学习笔记" scheme="https://blog.felixchen0707.cn/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="django" scheme="https://blog.felixchen0707.cn/tags/django/"/>
    
    <category term="python" scheme="https://blog.felixchen0707.cn/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>《Hollow Knight(空洞骑士)》简评</title>
    <link href="https://blog.felixchen0707.cn/posts/957c52d5/"/>
    <id>https://blog.felixchen0707.cn/posts/957c52d5/</id>
    <published>2022-07-07T16:00:00.000Z</published>
    <updated>2022-07-07T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>这次打算写点不一样的，就来浅浅聊一下最近走完主线剧情的《HollowKnight(空洞骑士)》吧。</p><span id="more"></span><h1 id="前言">前言</h1><p>  《空洞骑士》这款游戏其实一直存在于笔者的愿望单里，但是有好长一段时间也是仅仅存在于愿望单里而已。后来在室友的强烈推荐、并且Steam促销的双重驱动下，还是下载了这款游戏。6月份期末周一结束，便下定决心体验这款游戏。玩了40h也勉强算是通关了主线剧情。这里就简要地说一说自己想说的吧。</p><h1 id="关于游戏">关于游戏</h1><h2 id="谈谈设计">谈谈设计</h2><h3 id="boss设计">BOSS设计</h3><p>  如果要简单地概括《空洞骑士》的游戏形式，我想“平台跳跃游戏”的标签就足够让大家知道其游玩形式了。此外，这款平台跳跃游戏还包含了“魂类游戏的要素”，简而言之，就是不低的死亡成本和难度较高的BOSS设计。其实玩家们都会知道一个说法：三螳螂是多少新手的噩梦。</p><div class="tag-plugin image"><div class="image-bg" style="background:white;padding:16px;"><img src="https://i.imgtg.com/2022/07/11/eKWEI.jpg" alt="新手劝退关：三螳螂之战" fancybox="true" style="width:200px;"/></div><div class="image-meta"><span class="image-caption center">新手劝退关：三螳螂之战</span></div></div><p>  但其实，具有一定难度的BOSS设计也在很大程度上增加了游戏的可玩性。<strong>与其使用炫酷的特效和画面来告诉一个玩家你将面对的敌人有多么强大，倒不如直接让玩家体会被BOSS击败的无力感。</strong>当然了，这也为游戏制作者带来了不少的挑战：难度如何把控？如何让每一个不同的BOSS都有其特色？这其实是不容易把握的。笔者曾经体验过《Sekiro:Shadows DieTwice(只狼：影逝二度)》这款游戏。虽然这部作品依然非常出色，但其实有部分BOSS（或者严谨的说，精英怪）的设计是有些重复的（比如蚺蛇重藏和牛饮德次郎，但也有人认为他们其实是一个人，这里就不展开讨论了）。但不得不说，《空洞骑士》的BOSS设计并不会让人觉得厌烦，面对新的BOSS，总有新的打法可以尝试。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/07/11/eK0gc.jpg" alt="下砸老师：粪虫防御者" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">下砸老师：粪虫防御者</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/07/11/eKSbq.jpg" alt="黑冲老师：叛徒领主" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">黑冲老师：叛徒领主</span></div></div><h3 id="操作设计">操作设计</h3><p>  在玩家操作上，《空洞骑士》没有采用大量的按键、或者是游戏内技能选择来控制技能释放，所有的技能都可以通过少量键位完成释放。单纯攻击键，直接释放是平砍、与“上”键组合是上砍；与“下”组合是下劈(非常有技术含量的操作)；长按攻击键蓄力，通过独自释放、与上键组合、与下键组合完成三种不同的剑技；跳跃键按住时长控制跳跃幅度；长按施法是恢复等等。键位虽少，但是用好谈何容易。真正熟练之后，你会发现，看似不可能的道路可以通过下劈、二段跳、冲刺的组合轻松越过，竞技场的可以足不沾地与对手们进行空战等等。其实主角并没有飞行的能力，但又何尝不像在飞行。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/07/11/eZzCj.jpg" alt="竞技场空战：下劈、二段跳、螳螂抓钩的奇妙组合" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">竞技场空战：下劈、二段跳、螳螂抓钩的奇妙组合</span></div></div><h2 id="谈谈剧情">谈谈剧情</h2><p>  故事发生在一个称为“圣巢”的底下虫子王国里。上古时期，圣巢被虚空之力所占领。在这里，虚空才是一切的主宰。后来，名为幅光的神驻留在此地，利用自身的光芒将虚空的黑暗逐步逼退，最后将其困于深渊之中。自此，幅光便是这个王国的唯一领袖，圣巢也在他的带领下逐渐繁荣昌盛。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/07/11/evsuI.jpg" alt="幅光" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">幅光</span></div></div><p>  但后来，一只名为沃姆的虫子路过此地，有了驻足此地的想法。沃姆与幅光对于圣巢的统治有着根本的不一致观点。幅光，主张思想上的统一，反对繁衍；而沃姆，却强调虫子的多样性。于是，沃姆和幅光的大战一触即发。但是，沃姆不敌幅光，在大战中败下阵来，就此死去。</p><p>  但需要注意的是，在《空洞骑士》的世界观中，死亡并非消逝。所有的死亡，都会留下踪迹。沃姆也是这样。白王，就是沃姆死后的化身。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/07/11/evYFD.jpg" alt="白王的遗迹" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">白王的遗迹</span></div></div><p>幅光自然无法接受自己被白王击败的结局，于是，幅光利用梦境释放瘟疫感染圣巢内的虫子。在瘟疫的感染下，虫子们完全丧失了自主意识，只能进行基本且简单的思考。繁荣的圣巢，一刹那间成了死寂的废墟。在这里，只有无意识的虫子和瘟疫。</p><p>  但白王自然无法容忍这样事情的发生。他发现，圣巢内的蜂巢和螳螂村完全不受瘟疫感染。究其原因，是因为他们都有坚定的意志：蜂巢有自己的领袖信仰；而螳螂村，崇尚武力，他们的存在就是追求更高的荣耀。因此，他们不受瘟疫的感染。换句话说，只有真正的无意识或者坚定意志，才能免于幅光散播的瘟疫的感染。于是，容器就诞生了。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/07/11/evjUP.jpg" alt="击败BOSS后鞠躬表示敬意" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">击败BOSS后鞠躬表示敬意</span></div></div><p>  容器们的本体诞生于虚空，白色的头颅是容纳他们的虚空的自我的容器。他们源自虚空，所以完全没有个人的意志。他们的任务，就是对抗幅光的瘟疫，并永久地封印幅光，将圣巢变回原来的样子。但是，容器们并非都是可用的。容器必须没有自我意识，并且必须具有强大的能力。迈出深渊，就成为了容器们的第一道考验。深渊里，满是破碎的容器躯壳，他们都是白王失败的作品。但，有一个容器，成功通过了考验，迈出了深渊，完成了修炼。而他，就是纯粹容器，也叫<strong>空洞骑士</strong>。</p><blockquote><p>没有可以思考的心智</p><p>没有可以屈从的意志</p><p>没有为苦难而哭泣的声音</p><p>生于神与虚空之手</p><p>你必封印在众人梦中散布瘟疫的障目之光</p><p>你是容器</p><p>你是空洞骑士</p></blockquote><p>  空洞骑士承载着白王的愿望，将幅光封印在自己体内，从而阻止瘟疫的扩散。事实证明，他也成功了。瘟疫在圣巢渐渐散去，满是僵尸的圣巢，又渐渐开始恢复往日的荣光。为了保证彻底的封印，白王号召了三位守梦者来加固封印。作为代价，三位守梦者会陷入永久地沉睡。为了纪念他们，白王在泪城的不同地方建立了纪念碑。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/07/11/eyoUC.jpg" alt="纪念空洞骑士" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">纪念空洞骑士</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/07/11/eyqyL.jpg" alt="守梦人纪念碑" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">守梦人纪念碑</span></div></div><p>  但是，令白王没想到的是，纯粹容器并不纯粹。苦痛之路的尽头告诉我们，空洞骑士与白王的朝夕相处已经使得空洞骑士对白王产生了亲情。同时，空洞骑士在深渊的回头，也表示他对兄弟产生了情感。不纯粹的容器，势必要被幅光所感染。对于幅光而言，存在于梦境之中的他如果不被同族所记住，那他就与死亡无异。幅光渐渐感染空洞骑士，挣脱了束缚，又重新向圣巢散播了瘟疫。而这次，设法从深渊逃离的小骑士感受到了同类的召唤，回到了圣巢。</p><p>  小骑士在圣巢的探索中，一步步揭开王国的过去，直面自己空虚的内在，背负起重建圣巢的责任。</p><p>  当然，游戏也有多个结局。其中一个便是小骑士击倒先辈(空洞骑士)，进入梦境，直面幅光。这是小骑士第二次庄严拔刀，也是最后一次。击败幅光后，小骑士会舍弃自己的容器，将自己的虚空之躯暴露在外，在前辈的配合之下击杀幅光。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/07/11/ey4QB.jpg" alt="击败幅光" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">击败幅光</span></div></div><p>从此，瘟疫散去，但圣巢也不如从前。封印幅光的黑巢中剩下的，只有小骑士残破的外壳。而小骑士完成了自己的实名，重新回到深渊的虚空之中。</p><hr /><p>  整个游戏其实蛮黑暗的。不论是结束后的音乐画面，还是黑暗战胜光芒的主线剧情(当然这里的光芒才是反派)，又或是小骑士和其他大部分NPC的结局，都让人觉得遗憾。在这个游戏中，满是衰落王国的萧瑟和主角的自我牺牲。游戏的最后，白宫依然只存在于守卫的梦境之中，鹿角站铃铛也不会再热闹起来，深渊的一切也回归虚空，蓝湖边只剩下一把骨钉...</p><h1 id="后记">后记</h1><p>  其实我的文笔也蛮烂的，也第一次整理剧情和时间线。希望大家可以多提提意见什么的。写这篇文章也主要是记录一点自己的感受，毕竟到现在想起这段故事还会觉得可惜和遗憾。但是这个游戏真的太优秀了！我真的强推。最后的最后还想和大家分享几个我喜欢的BGM！绝对入股不亏！</p><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&amp;id=1309394487&amp;auto=1&amp;height=66"></iframe><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&amp;id=1309394512&amp;auto=1&amp;height=66"></iframe><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&amp;id=1309394503&amp;auto=1&amp;height=66"></iframe>]]></content>
    
    
    <summary type="html">&lt;p&gt;这次打算写点不一样的，就来浅浅聊一下最近走完主线剧情的《Hollow
Knight(空洞骑士)》吧。&lt;/p&gt;</summary>
    
    
    
    <category term="游戏" scheme="https://blog.felixchen0707.cn/categories/%E6%B8%B8%E6%88%8F/"/>
    
    
    <category term="游戏" scheme="https://blog.felixchen0707.cn/tags/%E6%B8%B8%E6%88%8F/"/>
    
    <category term="空洞骑士" scheme="https://blog.felixchen0707.cn/tags/%E7%A9%BA%E6%B4%9E%E9%AA%91%E5%A3%AB/"/>
    
  </entry>
  
  <entry>
    <title>6月24日</title>
    <link href="https://blog.felixchen0707.cn/posts/b56d6855/"/>
    <id>https://blog.felixchen0707.cn/posts/b56d6855/</id>
    <published>2022-06-23T16:00:00.000Z</published>
    <updated>2022-06-23T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>随便写写。</p><span id="more"></span><h2 id="写点东西或许以后会放出来">写点东西，或许以后会放出来</h2><p>上个学期，大概是三月份的时候，无比期待着转专业。当时对于转专业的热情似乎有些太上头，以至于有一段时间满脑子都是转专业，甚至连上课都会思绪飘走。到了四月中旬，知道不能在平台内转专业后，便想着要不要去安泰。说实话，我当时发现自己下意识有了这个想法以后，就觉得自己可能不是那么想学某一专业，我可能更加是在找寻一种<strong>逃离</strong>。当时和另外一个朋友说了这个想法，确信了自己似乎在转专业这件事上<strong>走错了路</strong>，目的似乎已经改变了。于是，经过内心的斗争，还是放弃了四月份的自主转专业。（其实说实在话，也有一部分原因是害怕自己下半学期太摆，导致学积分疯狂后退，便想着赶紧趁着优势润了）</p><p>其实说实话，我很喜欢生医工的氛围。疫情期间更让我看清楚生医工拥有大院所比拟不了的人文关怀。这点其实很显然，我想不管是谁都能感觉出来。因为这个其实也有点动摇到我的转专业决心了，虽然不是主要原因。但我想过，如果我在大院，可能并不会有老师那么关注我，也不会在被转运的时候有学院领导来慰问我，也不会有班主任打电话了解学习状况，更不会有刚步入学生会就能参加很多重要活动的核心策划。我得到的许多我认为很重要的东西，其实并不是我能力多么强，纯粹是因为学院规模小，给予了我更多的机会而已。我害怕转专业后，来到陌生的环境，可能再也得不到生医工给我的归属感。</p><p>最近可以说是我转专业热情消退的最严重的一段时间了。我退出了夏季学期选的NIS的课程，也对当初满怀希望报名的PRP丧失信心。因为我无法在这两门课中找到充足的动力去学习它们。原因或许只是因为我对它们不感兴趣，但也未必那么简单。可能是经历了一学期的神经紧绷，拼命追求一个不错的绩点后的精疲力竭；也能是PRP的能力要求对我来说确实为时尚早；也可能是NIS的那门课的设计确实让人难以产生兴趣。如果是这两种，那还好，至少不是我对信安专业知识的麻木，但如果是第一种，那是否意味着，<strong>在体验信安的学习过后，我已经提不起兴趣了呢？</strong>这种无法将问题正确归因的状态导致我这两天都无所事事。于是，加上三四月份的内心挣扎，我会质问我自己：<strong>我真的想转专业吗？还是纯粹是一种突发的错觉？</strong></p><p>但是时间不等人。大二的上学期，我需要同时决定转不转专业、是否辅修；如果是，如何安排这两件事？我需要利用时间搜集资源和信息，但是暑假，我还有其他任务在身，并且，好好地休息。这太难以决定了。我发现上大学后，需要自己决定并且承受后果的事情太多了，而且这些事情往往只有一次机会，错过就不再来。如果用两个词形容我现在的处境，就是犹豫和纠结。</p><p>最近把<ahref="/about/">关于我</a>页面的内容也做了一些修改，是因为我现在也不了解自己的想法。等到什么时候想明白了，再好好写吧。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;随便写写。&lt;/p&gt;</summary>
    
    
    
    <category term="碎碎念" scheme="https://blog.felixchen0707.cn/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
    
    <category term="碎碎念" scheme="https://blog.felixchen0707.cn/tags/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
  </entry>
  
  <entry>
    <title>Python学习笔记：列表和字典</title>
    <link href="https://blog.felixchen0707.cn/posts/fe46061e/"/>
    <id>https://blog.felixchen0707.cn/posts/fe46061e/</id>
    <published>2022-06-15T16:00:00.000Z</published>
    <updated>2022-06-15T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="作者序">作者序</h1><p>  学习一门编程语言，语法是最基础的。但是学习语法往往不是那么困难，因此，写一篇语法笔记似乎显得不是那么有必要。事实正如此，对于Python中的循环、判断等语句，我并没有整理的意图，因为我觉得太过多余，即使可以玩的很花。但是对于列表和字典这一章内容，其重要之处或许不在于其语法有多难，而是其体现了一些<strong>数据结构</strong>的思想。在C++中，线性表与这里的列表；查找表与这里的字典，都有着一些奇妙的联系。而因为Python很好的隐藏了一些底层实现，若不注意细节而使用这些内置函数和方法，是极有可能出错的。因此，本文将这些内容记录下来，既可以作为初学者的参考，又可以作为我的笔记以待后续查阅。</p><h1 id="正文">正文</h1><h2 id="列表">列表</h2><h3 id="什么是列表">什么是列表</h3><p>  Python中的列表是<strong>一系列特定元素按特定顺序构成的集合</strong>，这和C++中数组十分相似。对于列表，我们通常用<code>[]</code>来声明一个变量储存一个列表，例如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bicycles = [<span class="string">&#x27;trek&#x27;</span>, <span class="string">&#x27;cannondale&#x27;</span>, <span class="string">&#x27;redline&#x27;</span>, <span class="string">&#x27;specialized&#x27;</span>] <span class="comment">#初始化结束的列表</span></span><br><span class="line">empty = [] <span class="comment">#声明一个空列表</span></span><br></pre></td></tr></table></figure><h3 id="访问列表元素">访问列表元素</h3><p>  和C++相类似的，Python支持根据元素下标来访问元素。例如对于上面的<code>bicycles</code>列表，我们可以用<code>bicycles[0]</code>来访问元素<code>'trek'</code>。当然了，Python支持使用负数索引来访问列表元素，例如访问上面列表中的<code>'specialized'</code>，我们除了使用<code>bicycles[3]</code>，还可以使用<code>bicycles[-1]</code>来访问这个元素。<strong>对于长度未知的列表，我们可以用这个方式来访问末尾的几个元素。</strong></p><h3 id="列表元素的修改添加和删除">列表元素的修改、添加和删除</h3><p>  既然我们说列表是一种线性表，那么其需要能够支持线性表的基本操作。Python内置了丰富的函数和方法支持我们做到这些操作，下面逐一介绍之。</p><h4 id="修改元素">修改元素</h4><p>  对于修改元素，我们可以直接指定列表元素下标修改之，例如<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bicycles[<span class="number">0</span>] = <span class="string">&#x27;ducati&#x27;</span></span><br></pre></td></tr></table></figure>这样，我们就将列表中原本的<code>'trek'</code>元素修改成了我们指定的<code>'ducati'</code>元素。</p><h4 id="插入元素">插入元素</h4><p>  对于插入元素，Python提供了两种方法，分别是<code>insert()</code>和<code>append()</code>。对于前者支持在指定位置插入元素，而后者是将元素插入到列表尾，例如下面代码：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bicycles = [<span class="string">&#x27;cannondale&#x27;</span>, <span class="string">&#x27;redline&#x27;</span>, <span class="string">&#x27;specialized&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(bicycles)</span><br><span class="line">bicycles.append(<span class="string">&#x27;ducati&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(bicycles)</span><br><span class="line">bicycles.insert(<span class="number">2</span>, <span class="string">&#x27;trek&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(bicycles)</span><br></pre></td></tr></table></figure> 则对应的程序输出为 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[&#x27;cannondale&#x27;, &#x27;redline&#x27;, &#x27;specialized&#x27;]</span><br><span class="line">[&#x27;cannondale&#x27;, &#x27;redline&#x27;, &#x27;specialized&#x27;, &#x27;ducati&#x27;]</span><br><span class="line">[&#x27;cannondale&#x27;, &#x27;redline&#x27;, &#x27;trek&#x27;, &#x27;specialized&#x27;, &#x27;ducati&#x27;]</span><br></pre></td></tr></table></figure></p><h4 id="删除元素">删除元素</h4><p>  对于删除元素，一般有三种方法：<code>del</code>语句，<code>pop()</code>方法和<code>remove()</code>方法。</p><p>  对于<code>del</code>语句，你只需要指定删除的元素即可，例如<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> bicycles[<span class="number">0</span>]</span><br></pre></td></tr></table></figure> 就是删除bicycles中的第一个元素。</p><p>  对于<code>pop()</code>方法，一般由两种使用方式：无参数和指定元素下标。对于无参数的<code>pop()</code>方法，会删除当前列表中的最后一个元素。这种模式下的<code>pop()</code>方法和之前提到过的<code>append()</code>方法可以天然的实现一个<strong>栈</strong>。或者，你也可以指定<code>pop()</code>的参数，例如<code>bicycles.pop(1)</code>，则其中的<code>'redline'</code>元素就会被移出列表。<code>pop()</code>方法具有返回值，返回值是被删除的元素。</p><p>  对于<code>remove()</code>方法，是查找列表中<strong>第一个和指定参数相同的值</strong>，将其删去。注意，由于只删除第一个查找到的值，因而如果我们要将指定参数的值都删去，需要使用循环，例如<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">languages = [<span class="string">&#x27;cpp&#x27;</span>, <span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;go&#x27;</span>, <span class="string">&#x27;python&#x27;</span>, <span class="string">&#x27;html&#x27;</span>]</span><br><span class="line"><span class="keyword">while</span> <span class="string">&#x27;python&#x27;</span> <span class="keyword">in</span> languages:</span><br><span class="line">    languages.remove(<span class="string">&#x27;python&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(languages)</span><br></pre></td></tr></table></figure> 这种方式下，可以将列表中的所有指定元素都删除。</p><h3 id="组织列表">组织列表</h3><p>  除了基本的增删改查，我们对于列表还需要一些操作，这种操作不更改列表元素值，但是会更改元素之间的顺序。很便于使用的，Python依然为我们内置了强大的函数和方法来实现这些功能。</p><hr /><table><colgroup><col style="width: 33%" /><col style="width: 33%" /><col style="width: 33%" /></colgroup><thead><tr class="header"><th style="text-align: center;">函数名</th><th style="text-align: center;">解释</th><th style="text-align: center;">用法示例</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><code>sort()</code>方法</td><td style="text-align: center;">对列表永久非减（或非增）排列</td><tdstyle="text-align: center;"><code>bicycles.sort()</code>或者<code>bicycles.sort(reverse = True)</code></td></tr><tr class="even"><td style="text-align: center;"><code>sorted()</code>函数</td><td style="text-align: center;">对列表临时非减（或非增）排列</td><tdstyle="text-align: center;"><code>sorted(bicycles)</code>或者<code>sorted(bicycles, reverse = True)</code></td></tr><tr class="odd"><td style="text-align: center;"><code>reverse()</code>方法</td><td style="text-align: center;">列表逆置</td><td style="text-align: center;"><code>bicycles.reverse()</code></td></tr><tr class="even"><td style="text-align: center;"><code>len()</code>函数</td><td style="text-align: center;">列表求长</td><td style="text-align: center;"><code>len(bicycles)</code></td></tr><tr class="odd"><td style="text-align: center;"><code>example[:]</code></td><td style="text-align: center;">列表切片</td><td style="text-align: center;"><code>bicycles[0:3]</code></td></tr></tbody></table><hr /><p>  注意，复制列表时，注意一下两种方式的区别： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">foods1 = [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;pizza&#x27;</span>, <span class="string">&#x27;hamburger&#x27;</span>]</span><br><span class="line">foods1 = foods2 <span class="comment">#这种复制是错误的</span></span><br><span class="line">foods1 = foods2[:] <span class="comment">#利用列表切片的方式复制</span></span><br></pre></td></tr></table></figure>第一种复制的结果是使得<code>foods1</code>和<code>foods2</code>指向了同一个列表，使得在更改<code>foods1</code>的列表元素时，<code>foods2</code>也会一同改变。而后者是两个互不干涉的、独立的列表。</p><h2 id="字典">字典</h2><p>  Python中，字典是<strong>若干组键-值对的集合</strong>，其一般形式如下：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">target = &#123;</span><br><span class="line">    <span class="string">&#x27;color&#x27;</span>: <span class="string">&#x27;blue&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;points&#x27;</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="string">&#x27;speed&#x27;</span>: <span class="string">&#x27;fast&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>通过构建这样的键值对，我们可以通过键来访问其对应的值，有点类似于<strong>自定义下标的数组</strong>。上面示例中的<code>target</code>，就是我们说的字典。</p><h3 id="访问字典的值">访问字典的值</h3><p>  如同上面所说，我们完全可以把其当成数组来用。如果我们要知道<code>target</code>的<code>color</code>信息，我们可以通过下面的代码输出它：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(target[<span class="string">&#x27;color&#x27;</span>])</span><br></pre></td></tr></table></figure> 这时控制台输出<code>blue</code>。</p><h3 id="添加或修改键值对">添加或修改键值对</h3><p>  这两点放在一起讲的原因是，两者的语法是相同的。请读者参见以下代码：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">target[<span class="string">&#x27;color&#x27;</span>] = <span class="string">&#x27;red&#x27;</span> <span class="comment">#1</span></span><br><span class="line">target[<span class="string">&#x27;x_position&#x27;</span>] = <span class="number">4</span> <span class="comment">#2</span></span><br></pre></td></tr></table></figure>对于第一条语句，首先在字典<code>target</code>中寻找关键字<code>'color'</code>，由于找到的缘故，将其对应的值覆写为<code>'red'</code>。对于第二条语句，由于无法在字典中查询到<code>'x_position'</code>的任何记录，因而新建了一对键值关系，并将其插入了字典中。</p><h3 id="删除键值对">删除键值对</h3><p>  同样的，<code>del</code>语句给我们提供了删除键值对的方法。如果我们需要删除有关位置的信息，我们只需要<code>del target['x_position']</code>语句即可。</p><h3 id="遍历键值对">遍历键值对</h3><p>  如果我们想遍历键值对，可以使用的最简单的语句是： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> target.items():</span><br><span class="line">    <span class="built_in">print</span>(key + <span class="string">&quot; &quot;</span> + value)</span><br></pre></td></tr></table></figure>上述语句将字典中的每一个键值对，都分别把键、值赋值给了<code>key</code>和<code>value</code>。当然了，这时的输出顺序未必按照我们定义的一般按顺序输出，原因是<strong>字典只保证键值对的一一对应关系，而不在意互相之间的顺序问题</strong>。因此，要按照顺序遍历字典，我们需要使用其他的方式，</p><p>  对于字典，Python内置了两种方法：<code>keys()</code>方法和<code>values()</code>方法。两者返回的都是列表，前者是键组成的列表，后者是值组成的列表。相信到这里，你已经有思路如果按照顺序遍历字典了，这里给出一种方式：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">favorite_language = &#123;</span><br><span class="line">    <span class="string">&#x27;jen&#x27;</span>: <span class="string">&#x27;python&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;sarah&#x27;</span>: <span class="string">&#x27;c&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;edward&#x27;</span>: <span class="string">&#x27;ruby&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;phli&#x27;</span>: <span class="string">&#x27;python&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> person <span class="keyword">in</span> <span class="built_in">sorted</span>(favorite_language.keys()):</span><br><span class="line">    <span class="built_in">print</span>(person.title() + <span class="string">&quot;&#x27;s favorite language is &quot;</span> + favorite_language[person].title() + <span class="string">&quot;.&quot;</span>)</span><br></pre></td></tr></table></figure> 上面的程序输出结果是 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Edward&#x27;s favorite language is Ruby.</span><br><span class="line">Jen&#x27;s favorite language is Python.</span><br><span class="line">Phli&#x27;s favorite language is Python.</span><br><span class="line">Sarah&#x27;s favorite language is C.</span><br></pre></td></tr></table></figure>由此，我们做到了按照我们所想遍历字典。</p><h2 id="尾声">尾声</h2><p>  读者可以看到，Python中的列表和字典，其实已经包含了很多数据结构的东西，并且都给我们准备了不错的函数和方法。巧妙的是，这两个结构都可以自我嵌套，甚至互相嵌套，功能可以说已经非常强大了。因此，就像学习C++时刚接触到的函数一样，列表和字典也是水很深的内容之一。随着我的了解不断深入，我也会不断更新这篇文章。基础部分，就到此为止了。</p>]]></content>
    
    
    <summary type="html">Python中的列表和字典</summary>
    
    
    
    <category term="学习笔记" scheme="https://blog.felixchen0707.cn/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="Python" scheme="https://blog.felixchen0707.cn/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>数据结构试题分析</title>
    <link href="https://blog.felixchen0707.cn/posts/528509f9/"/>
    <id>https://blog.felixchen0707.cn/posts/528509f9/</id>
    <published>2022-05-28T13:26:28.000Z</published>
    <updated>2022-05-28T13:26:28.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="作者序">作者序</h3><p>  题目均来自于往年试卷，给出的代码都能够编译通过。</p><h3 id="例题一哈希表的使用">例题一：哈希表的使用</h3><p>  <strong>题面：</strong> 假设线性表采用顺序存储结构，试实现函数intDelRepeat()，用以删除所有重复元素，并返回删除元素的个数。要求算法的时间复杂度为<spanclass="math inline">\(O(n)\)</span>。线性表结构定义如下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">seqList</span>&#123;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span>* data;<span class="comment">//保存的元素数组</span></span><br><span class="line">    <span class="type">int</span> currentLength;<span class="comment">//元素个数</span></span><br><span class="line">    <span class="type">int</span> noData;<span class="comment">//数据中不存在的元素</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">DelRepeat</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//add your code here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>  代码实现如下，注意：测试代码未给出，请读者自行构造。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">seqList</span>&#123;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span>* data;<span class="comment">//保存的元素数组</span></span><br><span class="line">    <span class="type">int</span> currentLength;<span class="comment">//元素个数</span></span><br><span class="line">    <span class="type">int</span> noData;<span class="comment">//数据中不存在的元素</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">seqList</span>(<span class="type">int</span> n)&#123;<span class="comment">//构造函数</span></span><br><span class="line">        currentLength=n;<span class="comment">//元素个数</span></span><br><span class="line">        data=<span class="keyword">new</span> <span class="type">int</span>[n];</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;input data:&quot;</span>&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;++i)&#123;<span class="comment">//获取元素值</span></span><br><span class="line">            cin&gt;&gt;data[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span></span>&#123;<span class="comment">//展示数组元素</span></span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;the data are:&quot;</span>&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;currentLength;++i)&#123;</span><br><span class="line">            cout&lt;&lt;data[i]&lt;&lt;<span class="string">&quot;\t&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cout&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">delRepeat</span><span class="params">(<span class="type">int</span> n)</span></span>&#123;<span class="comment">//删除重复元素</span></span><br><span class="line">        noData=n;<span class="comment">//标记输入数据中不存在的元素</span></span><br><span class="line">        <span class="type">bool</span>* status=<span class="keyword">new</span> <span class="type">bool</span>[currentLength];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;currentLength;++i)&#123;<span class="comment">//创建判断元素，为真则该位置的数字出现过</span></span><br><span class="line">            status[i]=<span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span>* hashtable=<span class="keyword">new</span> <span class="type">int</span>[<span class="number">2</span>*currentLength];<span class="comment">//创建哈希表</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">2</span>*currentLength;++i)&#123;<span class="comment">//哈希表初始化</span></span><br><span class="line">            hashtable[i]=noData;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;currentLength;++i)&#123;</span><br><span class="line">            <span class="type">int</span> pos=data[i]%(<span class="number">2</span>*currentLength);<span class="comment">//获得哈希值</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(hashtable[pos]!=noData&amp;&amp;hashtable[pos]!=data[i]) (++pos)%(<span class="number">2</span>*currentLength);<span class="comment">//定位到第一个可以插入的位置</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(hashtable[pos]==data[i])&#123;</span><br><span class="line">                status[i]=<span class="literal">true</span>;<span class="comment">//如果有该元素，标记为待删除元素</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                hashtable[pos]=data[i];<span class="comment">//没有该元素，插入该元素</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="comment">//end for</span></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> newLength=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> oldLength=currentLength;</span><br><span class="line">        <span class="type">int</span>* tmp=<span class="keyword">new</span> <span class="type">int</span>[currentLength];<span class="comment">//装载没被删去的元素</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;currentLength;++i)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!status[i])&#123;<span class="comment">//如果判断数组对应位置为假，保留该数字</span></span><br><span class="line">                tmp[j]=data[i];</span><br><span class="line">                ++j;</span><br><span class="line">                newLength++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">delete</span>[] data;<span class="comment">//内存管理</span></span><br><span class="line">        data=tmp;<span class="comment">//数据内容更新</span></span><br><span class="line">        <span class="keyword">delete</span>[] hashtable;</span><br><span class="line">        currentLength=newLength;<span class="comment">//更新数组长度</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (oldLength-currentLength);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>  <strong>总结：</strong>对于需要反复回溯已遍历元素中某个元素出现与否的，哈希表是一个很好的解决方式，可以减少<spanclass="math inline">\(O(n)\)</span>的算法复杂度。注意哈希表的重点：<strong>哈希函数</strong>和<strong>冲突解决</strong>。</p><h3 id="例题二二叉树">例题二：二叉树</h3><p>  给定两个二叉树，想象当你将它们中的一个覆盖到另一个上时，两个二叉树的一些节点便会重叠。请完善下列算法，实现将上述两个二叉树合并为一个新的二叉树。合并的规则是如果两个节点重叠，那么将他们的值相加作为节点合并后的新值，否则不为NULL的节点将直接作为新二叉树的节点。注意：合并后的二叉树中结点允许直接使用这两个二叉树上的结点。给出二叉树的定义：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">binaryTree</span>&#123;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">node</span>&#123;<span class="comment">//二叉树的节点类</span></span><br><span class="line">        <span class="type">int</span> value;</span><br><span class="line">        node* left;</span><br><span class="line">        node* right;</span><br><span class="line">        <span class="built_in">node</span>(<span class="type">int</span> val)&#123;<span class="comment">//构造函数</span></span><br><span class="line">            value=val;</span><br><span class="line">            left=<span class="literal">NULL</span>;</span><br><span class="line">            right=<span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    node* root;<span class="comment">//二叉树的根节点</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="function">node* <span class="title">mergeTrees</span><span class="params">(node* t1, node* t2)</span></span>&#123;<span class="comment">//合并二树</span></span><br><span class="line">        <span class="comment">//add your code here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>  想法是：合并二树可以看成三个过程：<strong>合并根节点</strong>、<strong>递归调用合并左右子树</strong>。因此，合并二树的操作并不难，只需要注意递归跳出的条件：其中一棵树为空树即可。为了完成代码的检查，我们还需要复习一遍二叉树的构建和层次遍历的知识点。以下代码包含了测试代码，可以直接运行。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">binaryTree</span>&#123;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">node</span>&#123;<span class="comment">//二叉树的节点类</span></span><br><span class="line">        <span class="type">int</span> value;</span><br><span class="line">        node* left;</span><br><span class="line">        node* right;</span><br><span class="line">        <span class="built_in">node</span>(<span class="type">int</span> val)&#123;<span class="comment">//构造函数</span></span><br><span class="line">            value=val;</span><br><span class="line">            left=<span class="literal">NULL</span>;</span><br><span class="line">            right=<span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    node* root;<span class="comment">//二叉树的根节点</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">binaryTree</span>()&#123;<span class="comment">//基于层次遍历的构造函数</span></span><br><span class="line">        <span class="type">int</span> val;</span><br><span class="line">        <span class="type">int</span> lval;</span><br><span class="line">        <span class="type">int</span> rval;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;input the root:&quot;</span>;</span><br><span class="line">        cin&gt;&gt;val;</span><br><span class="line">        cout&lt;&lt;endl;</span><br><span class="line">        root=<span class="keyword">new</span> <span class="built_in">node</span>(val);</span><br><span class="line">        queue&lt;node*&gt; que1;</span><br><span class="line">        que1.<span class="built_in">push</span>(root);</span><br><span class="line">        <span class="keyword">while</span>(!que1.<span class="built_in">empty</span>())&#123;</span><br><span class="line">            node* tmp=que1.<span class="built_in">front</span>();</span><br><span class="line">            que1.<span class="built_in">pop</span>();</span><br><span class="line">            cout&lt;&lt;<span class="string">&quot;input the two children of the given node &quot;</span>&lt;&lt;tmp-&gt;value&lt;&lt;<span class="string">&quot;:&quot;</span>;</span><br><span class="line">            cin&gt;&gt;lval&gt;&gt;rval;</span><br><span class="line">            cout&lt;&lt;endl;</span><br><span class="line">            <span class="keyword">if</span>(lval)&#123;</span><br><span class="line">                tmp-&gt;left=<span class="keyword">new</span> <span class="built_in">node</span>(lval);</span><br><span class="line">                que1.<span class="built_in">push</span>(tmp-&gt;left);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(rval)&#123;</span><br><span class="line">                tmp-&gt;right=<span class="keyword">new</span> <span class="built_in">node</span>(rval);</span><br><span class="line">                que1.<span class="built_in">push</span>(tmp-&gt;right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;binarytree has been built!&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">binaryTree</span>(node* r)&#123;<span class="comment">//给定根节点的构造函数</span></span><br><span class="line">        root=r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span></span>&#123;<span class="comment">//层次遍历</span></span><br><span class="line">        queue&lt;node&gt; que1;</span><br><span class="line">        que1.<span class="built_in">push</span>(*root);</span><br><span class="line">        <span class="keyword">while</span>(!que1.<span class="built_in">empty</span>())&#123;</span><br><span class="line">            node tmp=que1.<span class="built_in">front</span>();</span><br><span class="line">            que1.<span class="built_in">pop</span>();</span><br><span class="line">            cout&lt;&lt;tmp.value&lt;&lt;<span class="string">&quot; &quot;</span>;</span><br><span class="line">            <span class="keyword">if</span>(tmp.left)&#123;</span><br><span class="line">                que1.<span class="built_in">push</span>(*(tmp.left));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(tmp.right)&#123;</span><br><span class="line">                que1.<span class="built_in">push</span>(*(tmp.right));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;display completed!&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">node* <span class="title">findRoot</span><span class="params">()</span></span>&#123;<span class="comment">//返回二叉树根节点的位置</span></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">node* <span class="title">mergeTrees</span><span class="params">(node* t1, node* t2)</span></span>&#123;<span class="comment">//合并二树</span></span><br><span class="line">        <span class="keyword">if</span>(!t1) <span class="keyword">return</span> t2;<span class="comment">//递归跳出条件，即其中一棵树是空树</span></span><br><span class="line">        <span class="keyword">if</span>(!t2) <span class="keyword">return</span> t1;</span><br><span class="line"></span><br><span class="line">        node* t3=<span class="keyword">new</span> <span class="built_in">node</span>(t1-&gt;value+t2-&gt;value);</span><br><span class="line">        t3-&gt;left=<span class="built_in">mergeTrees</span>(t1-&gt;left,t2-&gt;left);<span class="comment">//假定该函数能够完成合并二树的操作，只需要对左右子树递归调用</span></span><br><span class="line">        t3-&gt;right=<span class="built_in">mergeTrees</span>(t1-&gt;right,t2-&gt;right);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> t3;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    binaryTree tree1;</span><br><span class="line">    tree1.<span class="built_in">display</span>();</span><br><span class="line">    binaryTree tree2;</span><br><span class="line">    tree2.<span class="built_in">display</span>();<span class="comment">//构建两棵树并展示之</span></span><br><span class="line">    <span class="function">binaryTree <span class="title">tree3</span><span class="params">(tree1.mergeTrees(tree1.findRoot(),tree2.findRoot()))</span></span>;<span class="comment">//合并子树</span></span><br><span class="line">    tree3.<span class="built_in">display</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="例题三拓扑排序">例题三：拓扑排序</h3><p>  <strong>题面：</strong>学生需要修读完所有的课程才能毕业，这些课程之间有先导关系（比如要修读数据结构，必须先修读程序设计思想方法）。假设任意一门课程可以在任何一个学期给满足条件的学生选修，且学生每个学期可以选修的课程数不限。先给出一些课程与课程之间的关系，求能够修完所有课程的最少学期数。</p><p>  <strong>输入格式：</strong> 第1行：n m //正整数n，代表课程的数量。非负整数m代表要给出几个先导关系。第2行到第1+m行: a b//每行两个整数：代表要选修编号为a的课程，必须先修读编号为b的课程。</p><p>  <strong>输出格式：</strong>一个整数，即修完所有课程的最少学期数。</p><p>  <strong>思路：</strong>本题可以参考拓扑排序的方式，即：选取入度为零的点，将其移除，然后更新有向图；再移除入度为零的点，如此循环。实现的代码如下，主函数也已经给出，且能够编译通过。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">adjListGraph</span>&#123;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">edgeNode</span>&#123;</span><br><span class="line">        <span class="type">int</span> end;</span><br><span class="line">        edgeNode* next;</span><br><span class="line">        <span class="built_in">edgeNode</span>(<span class="type">int</span> e,edgeNode* n=<span class="literal">NULL</span>)&#123;</span><br><span class="line">            end=e;</span><br><span class="line">            next=n;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">verNode</span>&#123;</span><br><span class="line">        <span class="type">int</span> ver;</span><br><span class="line">        edgeNode* head;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">verNode</span>(<span class="type">int</span> val=<span class="number">0</span>)&#123;</span><br><span class="line">            ver=val;</span><br><span class="line">            head=<span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    verNode* verList;</span><br><span class="line">    <span class="type">int</span> Vers;</span><br><span class="line">    <span class="type">int</span>* inDegree;<span class="comment">//入度统计数组</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">adjListGraph</span>(<span class="type">int</span> vSize)&#123;<span class="comment">//构造函数</span></span><br><span class="line">        Vers=vSize;</span><br><span class="line">        verList=<span class="keyword">new</span> verNode[Vers+<span class="number">1</span>];</span><br><span class="line">        inDegree=<span class="keyword">new</span> <span class="type">int</span>[Vers+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Vers;++i)&#123;</span><br><span class="line">            verList[i].ver=i;</span><br><span class="line">            inDegree[i]=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> end,<span class="type">int</span> in)</span></span>&#123;</span><br><span class="line">        verList[in].head=<span class="keyword">new</span> <span class="built_in">edgeNode</span>(end,verList[in].head);</span><br><span class="line">        inDegree[end]++;<span class="comment">//入度增加</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">topSort</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> counter=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> remain=Vers;<span class="comment">//剩余未被删除的元素个数，用于判断循环结束</span></span><br><span class="line">        <span class="type">int</span> current;<span class="comment">//当前将要出队的元素</span></span><br><span class="line">        queue&lt;verNode&gt; que1;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(remain!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=Vers;++i)&#123;</span><br><span class="line">                <span class="keyword">if</span>(inDegree[i]==<span class="number">0</span>)&#123;</span><br><span class="line">                    que1.<span class="built_in">push</span>(verList[i]);<span class="comment">//入度为零的点入队</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="comment">//end for</span></span><br><span class="line">            <span class="keyword">while</span>(!que1.<span class="built_in">empty</span>())&#123;</span><br><span class="line">                current=que1.<span class="built_in">front</span>().ver;</span><br><span class="line">                que1.<span class="built_in">pop</span>();</span><br><span class="line">                edgeNode*p=verList[current].head;</span><br><span class="line">                <span class="keyword">while</span>(p)&#123;</span><br><span class="line">                    inDegree[p-&gt;end]--;<span class="comment">//该出队元素所指向的元素入度自减</span></span><br><span class="line">                    p=p-&gt;next;</span><br><span class="line">                &#125;</span><br><span class="line">                remain--;</span><br><span class="line">                inDegree[current]=<span class="number">-1</span>;<span class="comment">//已修完的课在下一次循环不需要被读取</span></span><br><span class="line">            &#125;</span><br><span class="line">            counter++;<span class="comment">//完成后计数器增加</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> counter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">int</span> n,m;<span class="comment">//课程数量、先导关系</span></span><br><span class="line">    cin&gt;&gt;n&gt;&gt;m;</span><br><span class="line">    <span class="function">adjListGraph <span class="title">graph</span><span class="params">(n)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=m;++i)&#123;</span><br><span class="line">        <span class="type">int</span> a,b;</span><br><span class="line">        cin&gt;&gt;a&gt;&gt;b;</span><br><span class="line">        graph.<span class="built_in">insert</span>(a,b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    cout&lt;&lt;graph.<span class="built_in">topSort</span>()&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  上述程序中指定队列的原因是，为了区分出每一学期修了多少门课。每一个学期进行一次统一的入队操作，而后出队直至队空为止。</p>]]></content>
    
    
    <summary type="html">本文选择了数据结构的一些考题，给出了完整的代码实现。</summary>
    
    
    
    <category term="学习笔记" scheme="https://blog.felixchen0707.cn/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="数据结构" scheme="https://blog.felixchen0707.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
  </entry>
  
  <entry>
    <title>DES加密算法</title>
    <link href="https://blog.felixchen0707.cn/posts/e407c7d6/"/>
    <id>https://blog.felixchen0707.cn/posts/e407c7d6/</id>
    <published>2022-05-18T02:58:16.000Z</published>
    <updated>2022-05-18T02:58:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>DES加密算法是目前使用最广泛的对称加密算法。它体现了对称加密算法中最经典的Feistel结构。尽管DES加密算法注定要为新的加密标准让出位置，但依旧是我们深入理解对称加密的最好的例子。</p><span id="more"></span><h1 id="feistel结构设计">Feistel结构设计</h1><h2 id="流密码与分组密码">流密码与分组密码</h2><p>  在最开始，我们有必要了解一下流密码和分组密码。对于明文<spanclass="math inline">\(m\)</span>，我们有两种加密方式，一种是逐位加密，我们称这种加密方式为<strong>流密码</strong>；另一种方式是按照一定的长度作为一组一同加密，这样的加密方式称为<strong>分组密码</strong>。流密码的典型例子是凯撒密码，它就是对明文逐位加密的。相较于流密码，我们实际应用中更偏向于使用分组密码，因为流密码有一个缺陷：如果密钥长度不足，那么字符的统计规律就难以被隐藏，很容易受到基于统计的攻击。分组密码在一定程度上会更多地抹去统计信息，因此也就显得更安全。我们主要讨论分组密码。</p><h2 id="feistel密码结构的设计动机">Feistel密码结构的设计动机</h2><p>  我们不妨假设分组密码作用在长度为<spanclass="math inline">\(n\)</span>的明文分组上，相应地，我们得到相同长度的密文。我们假设明文信息流是<strong>二进制流</strong>，那么长度为<spanclass="math inline">\(n\)</span>的分组至多有<spanclass="math inline">\(2^n\)</span>中情况。考虑到我们需要从密文复原到明文，因此，我们选择的分组替代方式应该是<strong>单射</strong>的。我们称这样的变换为<strong>可逆变换</strong>，也叫<strong>非奇异变换</strong>。上述例子中，非奇异变换一共有<spanclass="math inline">\(2^n!\)</span>种<em>（注：对于第一个分组，我们可以从<spanclass="math inline">\(2^n\)</span>中选取一个映射；对于第二个，有<spanclass="math inline">\(2^n-1\)</span>种；以此类推）</em>。这种加密方式下，映射表格就是密钥。这样看来，我们具有很大的密钥空间，任意一种分组情况选取的映射是任意的。我们称这种加解密映射为<strong>任意可逆变换</strong>。Feistel称这种密码为理想分组密码，因为<strong>它允许生成最大数量的加密映射来映射明文分组</strong>。</p><p>  然而，这种方法是难以应用的。如果我们分组的<spanclass="math inline">\(n\)</span>的值不够大（例如4），那它就和流密码没什么区别，非常容易基于统计规律被攻破；那<spanclass="math inline">\(n\)</span>很大的情况呢？统计规律固然被隐藏了，但是我们提过一句话：<strong>映射表格就是我们的密钥</strong>。对于分组长度为<spanclass="math inline">\(n\)</span>的任意可逆变换，其每种映射需要<spanclass="math inline">\(n\)</span>位表示（即分组长度），并且我们有<spanclass="math inline">\(2^n\)</span>中不同分组情况，因此，密钥长度可以表示为<span class="math display">\[L(n)=n\cdot 2^n.\]</span></p><p>  指数级的增长是十分恐怖的。今天的密钥长度一般不少于64位，如果我们令上式中的<spanclass="math inline">\(n=64\)</span>，其结果是<spanclass="math inline">\(10^{21}\)</span>位！这个长度是不可接受的。因此，Feistel指出，我们只需要<strong>一种对任意可逆变换的近似</strong>。一般我们认为密钥空间是上面所提到的<spanclass="math inline">\(2^n!\)</span>中的一个子集。于是，我们依靠什么标准来选取这个密钥空间使得其在降低密钥空间大小的情况下依然能保持足够的安全呢？</p><h2 id="feistel的设想">Feistel的设想</h2><p>  Feistel提出了一种<strong>基于乘积密码的概念来逼近任意可逆变换</strong>的方式。乘积密码是说，<strong>利用不同的两套或多套密码来加密，得到的结果比其中任意一种的加密效果都要强</strong>。特别的，Feistel建议使用<strong>替代</strong>和<strong>置换</strong>的反复使用。替代是指明文中的某一元素或某一组被<strong>唯一地</strong>替换成为密文中的某一元素或某一组；置换是改变明文元素顺序，但明文元素本身并不发生改变。这样的目的是<strong>产生混淆和扩散</strong>，这是香农提出的概念。其大致原理是，使得密文中的某一字符<strong>尽可能多地受到来自不同明文字符的影响</strong>，这样做可以有效抵御基于统计的密码分析。当然，最好的情况是<strong>所有统计规律都独立于密钥的选取</strong>，但这就是我们前面说的<strong>任意可逆变换</strong>，是不能够实际应用的。排除这种可能，由于密文的生成是明文和密钥的函数，因此，密文的统计规律<strong>不可避免出现密钥的信息</strong>。因此，大量使用替代和置换可以使这种关系变得复杂，挫败密码分析，这就是我们要的结果。</p><h2 id="feistel结构的基本特征">Feistel结构的基本特征</h2><p>  <strong>分组长度</strong>：不言而喻的，分组长度越大，密码的安全性就越高。正如前面分析的那样，<strong>这种安全性来源于混淆和扩散</strong>。一般的分组长度是64-bit，高级加密标准下是128-bit。</p><p>  <strong>密钥长度</strong>：密钥越长安全性也显而易见的越高。但是这种安全性<strong>建立在牺牲了加解密速度之上</strong>。现代密码学中我们认为64-bit的密钥还不够，一般选取128-bit。</p><p>  <strong>迭代轮数</strong>：迭代轮数是降低统计特征的最好方式。一般的推荐迭代轮数是16。</p><p>  <strong>子密钥产生算法</strong>：我们在前面说过，我们要使用的是<strong>乘积密码的原理</strong>，因此，如何生成每一步的密钥是关键的问题。产生密钥的算法越复杂，安全性就越高。</p><p>  <strong>轮函数</strong><spanclass="math inline">\(F\)</span>：轮函数是明文和密钥的函数。同样的，轮函数越复杂，密码安全性越高。</p><p>  <strong>快速加解密</strong>：对称密码的优势之一就是速度快。作为对称加密算法的Feistel结构，也应当保持这样的优势。</p><p>  <strong>简化分析难度</strong>：尽管我们喜欢把算法设计得尽可能使密码分析变得困难，然而将算法设计得易于分析也有它的好处。如果说算法被描述得简单一些，我们就更容易分析出其脆弱性，进而设计更可靠的加密算法。不过，我们后续要介绍的DES并没有简单的分析方式。</p><h2 id="feistel加密算法">Feistel加密算法</h2><p>  本节介绍Feistel加密算法，其大致原理可以用下面的图来直观表示。当然我们也会对整个流程做出解释。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/06/03/nS2CC.webp" alt="Feistel加密算法" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">Feistel加密算法</span></div></div><p>  不妨假设我们的明文输入是<spanclass="math inline">\(2w\)</span>位的。我们先对其分组，分成两部分，每一个部分是<spanclass="math inline">\(w\)</span>位长的，并且将它们分别记作<spanclass="math inline">\(LE_0\)</span>和<spanclass="math inline">\(RE_0\)</span>。我们对这个明文进行第一次迭代。我们如何获取<spanclass="math inline">\(LE_1\)</span>呢？很简单，我们直接将输入数据的右半部分拷贝过来即可，即<span class="math display">\[\begin{equation}    LE_1=RE_0.\end{equation}\]</span> 比较复杂的是<spanclass="math inline">\(RE_1\)</span>的获得。</p><p>  我们先选取明文的右半部分<spanclass="math inline">\(RE_0\)</span>，对其作用轮函数<spanclass="math inline">\(F\)</span>，<strong>密钥选择第一把子密钥</strong>，即这部分的运算结果是<span class="math display">\[F(RE_0,K_1).\]</span> 我们将上述得到的式子和<spanclass="math inline">\(LE_0\)</span>作异或运算，于是得到我们需要的<spanclass="math inline">\(RE_1\)</span>，这个过程用数学表达式表示就是 <spanclass="math display">\[\begin{equation}    RE_1=LE_0\oplus F(RE_0,K_1).\end{equation}\]</span>这就是第一轮迭代的结果。我们将这个迭代再重复15次，即一共迭代16次。上面式子(1)(2)用一般地表示方法即为<span class="math display">\[\begin{equation}    LE_i=RE_{i-1},\end{equation}\]</span> <span class="math display">\[\begin{equation}    RE_i=LE_{i-1}\oplus F(RE_{i-1},K_{i}).\end{equation}\]</span> 当我们得到 <span class="math inline">\(LE_{16}\)</span> 和<span class="math inline">\(RE_{16}\)</span>后，我们对这两部分<strong>作最后一次交换</strong>，得到 <spanclass="math display">\[LE_{17}=RE_{16},\]</span> <span class="math display">\[RE_{17}=LE_{16},\]</span> 于是，上述两段拼接起来就是我们产生的密文。</p><p>  这就是Feistel结构的加密过程。</p><h2 id="feistel解密算法">Feistel解密算法</h2><p>  既然其加密算法看上去这么复杂，其解密算法会不会也很复杂呢？答案是<strong>并不是</strong>。其解密算法和加密算法<strong>完全一致</strong>，除了<strong>使用密钥的顺序和加密过程相反</strong>。这样究竟能不能复原出明文，这是我们关心的问题，下面我们给出证明。</p><p>  我们要知道的是，<span class="math inline">\(LE_i\)</span>和<spanclass="math inline">\(RE_i\)</span>在我们知道密钥<spanclass="math inline">\(K_i\)</span>的情况下能不能反解出前一步的密文。我们由式(4)可以知道<span class="math display">\[LE_{i-1}=RE_i\oplus F(RE_{i-1},K_i),\]</span> 又由于<span class="math inline">\(RE_{i-1}=LE_i\)</span>，有<span class="math display">\[LE_{i-1}=RE_i\oplus F(LE_i,K_i).\]</span> 又显然有 <span class="math display">\[RE_{i-1}=LE_i,\]</span>也就是说，我们获得了密文后，便可以一层层代入解密。至于在加密过程中为什么要增加一步互换位置，是因为互换以后我们得到的密文中的右半部分<span class="math display">\[RD_0=RE_{17}=LE_{16},\]</span>这样，我们在解密过程中可以保持对右半部分使用轮函数，<strong>保证了加密解密算法的一致</strong>。</p><p>  值得注意的是，上述论证过程中我们<strong>并没有假设轮函数具有什么性质</strong>，因为事实上，轮函数是可以任意选取的，<strong>这不影响我们的解密过程</strong>。我们后面要讲述的DES，实际上是Feistel结构的一个具体实现。</p><h1 id="des加密算法">DES加密算法</h1><p>  DES加密算法以64位为分组，密钥长度为56位<em>（实际上，使用的密钥为64位，但是其中8位是校验位，不参与实际运算，因此说是56位）</em>。加密的粗糙流程可见下图。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/06/03/nSCpx.md.jpg" alt="DES加密流程" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">DES加密流程</span></div></div><p>  我们获取到明文输入后，首先对其进行初始置换(<spanclass="math inline">\(IP\)</span>)，然后经过16轮迭代，最后经过左右互换（这点在Feistel结构中提到过），然后通过逆初始置换(<spanclass="math inline">\(IP^{-1}\)</span>)，得到密文输出。<strong>初始置换和逆初始置换是一对互逆运算</strong>。笔者认为其存在的意义仅仅是<strong>增加解密复杂度</strong>。每一轮加密的密钥来源于64位初始密钥生成的子密钥。以下我们解释一下DES的详细加密过程。</p><h2 id="初始置换">初始置换</h2><p>  初始置换和逆初始置换只在最开始和结束使用，其原理是<strong>地址置换</strong>，即将对应位置所指的地址的数据置换到该位上。下面给出了具体的初始置换和逆初始置换表。这里不多赘述。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/06/05/n82UN.md.png" alt="初始置换" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">初始置换</span></div></div><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/06/05/n86vC.md.png" alt="逆初始置换" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">逆初始置换</span></div></div><h2 id="轮函数的细节">轮函数的细节</h2><p>  我们先给出轮函数的示意图，然后再解释。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/06/03/nSu6X.md.jpg" alt="轮函数的细节" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">轮函数的细节</span></div></div><p>  如同我们在Feistel结构中提到的，我们对64位明文信息分组称为左右两部分。由图上可知，轮函数外的步骤和Feistel结构完全一致，我们不多赘述。关键来看一下轮函数中的最重要的四步：<strong>E扩展置换</strong>，<strong>子密钥运算</strong>，<strong>S盒压缩</strong>和<strong>P置换</strong>。</p><h3 id="e扩展置换">E扩展置换</h3><p>  由于参加运算的子密钥是48位的，然而分组后我们的明文信息只有32位，因此，需要对明文信息扩展称为48位。E扩展是有对应表格的，<strong>它接受32位的输入，产生48位的输出</strong>。具体的扩展方式可以见下面的表格和例子。<strong>这样的扩展会产生16个重复的位</strong>。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/06/05/n899S.png" alt="Ebox" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">Ebox</span></div></div><h3 id="子密钥运算">子密钥运算</h3><p>  将扩展置换结果与子密钥进行异或运算。</p><h3 id="s盒压缩">S盒压缩</h3><p>  上述的运算结果是48位的，然而，轮函数迭代后的位数是不能够增多的。因此，我们需要对48位的数据压缩，<strong>将之长度还原到32位</strong>。S盒压缩就是在完成这一步。<strong>S盒压缩接受48位的输入，产生32位的输出。</strong>其原理如下图。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/06/03/nSjSN.webp" alt="S盒压缩过程" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">S盒压缩过程</span></div></div><p>  S盒首先将输入分成6位一组，共计8组。我们不妨假设输入是011001。首先我们获取输入的首尾两位，将其作为行号；剩余的四位作为列号。在上面的例子中，行号是1（01）；列号是12（1100）。我们查询S盒置换表，知道这一位数字是9，即1001。于是，1001就是我们的输出。对于其他7组也是如此，最后一共输出8组4位，共32位的结果。值得注意的是，<strong>S盒不止一个</strong>。其设计标准是不公开的，但S盒是公开的。</p><h3 id="p置换">P置换</h3><p>  也是一种简单的置换，具有置换对照表。</p><h3 id="子密钥的生成">子密钥的生成</h3><p>  我们输入的是64位的密钥。于是我们通过PC-1置换，将密钥的校验位去除，同时<strong>打乱密钥的顺序</strong>，得到56位的密钥。对这个56位密钥我们再次进行分组，分为左右两半部分各28位长度的密钥。我们把这个密钥称为<spanclass="math inline">\(C_0D_0\)</span>。我们对其两部分分别进行左移，左移位数查表可见。对于每一次的左移结果，我们通过PC-2置换得到该次加密的子密钥。重复上述操作，我们可以得到所有加密过程需要的子密钥。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/06/03/nS3kt.md.jpg" alt="子密钥生成使用的PC-1、PC-2置换" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">子密钥生成使用的PC-1、PC-2置换</span></div></div><h1 id="des密码的强度">DES密码的强度</h1><p>  对于P置换和S盒压缩是有要求的，就是<strong>要尽可能增加其中某一位对其他所有位变化的敏感度</strong>，也就是说，<strong>增加算法的扩散程度</strong>，来弥补分组算法本身难以逃脱统计攻击的特点。因此，不论是置换表格的设计，又或是子密钥的生成，都要严格遵循一个效应，我们称之为<strong>雪崩效应</strong>。雪崩效应说的是，明文或密钥的微小改变将对密文产生很大的影响，换句话说，<strong>明文和密钥的任何一位的改变会导致密文很多位的改变</strong>。这样，分析者搜索密钥的难度大大上升，加密算法也更加健壮。</p><p>  但，DES密码并不是牢不可破的。其安全性一直备受质疑。曾在1998年，有一台专门针对DES加密算法的计算机成功破译了DES加密算法。但实际上，这种破译往往需要我们知道待破译的目标语言特点，例如语言特征，文件格式等等。因此，在不知道这些信息的情况下，破译DES依然是有难度的。不论如何，我们如今也有许多DES的替代加密方案例如AES和3DES。对这些方案，我们后续也会加以讨论。</p><p>  不论如何，Feistel结构和DES加密算法仍旧是对称加密算法中的经典，理解它们对我们后续的深入学习是有百利而无一害的。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;DES加密算法是目前使用最广泛的对称加密算法。它体现了对称加密算法中最经典的Feistel结构。尽管DES加密算法注定要为新的加密标准让出位置，但依旧是我们深入理解对称加密的最好的例子。&lt;/p&gt;</summary>
    
    
    
    <category term="学习笔记" scheme="https://blog.felixchen0707.cn/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="密码学" scheme="https://blog.felixchen0707.cn/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
  </entry>
  
  <entry>
    <title>KMP算法</title>
    <link href="https://blog.felixchen0707.cn/posts/2da0528d/"/>
    <id>https://blog.felixchen0707.cn/posts/2da0528d/</id>
    <published>2022-05-18T02:52:47.000Z</published>
    <updated>2022-05-18T02:52:47.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="问题">问题</h1><p>  给定一个字符串<spanclass="math inline">\(A\)</span>，要求从字符串<spanclass="math inline">\(A\)</span>中查找另一个字符串<spanclass="math inline">\(B\)</span>是否出现。如果出现，返回查找的字符串<spanclass="math inline">\(B\)</span>在<spanclass="math inline">\(A\)</span>中的位置，否则返回-1。</p><h1 id="最简单的解决方法枚举法">最简单的解决方法——枚举法</h1><p>  <strong>枚举法</strong>当然可以解决这个问题：我们可以在从<spanclass="math inline">\(A\)</span>字符串中取第一位，然后逐位往后与<spanclass="math inline">\(B\)</span>串比较。如果匹配则返回答案；若不匹配，则从<spanclass="math inline">\(A\)</span>字符串的第二位开始，重复上述操作，直到找到字符串位置或者字符串<spanclass="math inline">\(A\)</span>被遍历完毕。</p><p>  我们来分析一下这个的算法复杂度。我们假设字符串<spanclass="math inline">\(A\)</span>和<spanclass="math inline">\(B\)</span>的长度分别为<spanclass="math inline">\(m\)</span>和<spanclass="math inline">\(n\)</span>，那么这个算法的最差情况需要比较<spanclass="math inline">\(m\times n\)</span>次，即这个算法是<spanclass="math inline">\(O(m\times n)\)</span>的。</p><h1 id="kmp算法">KMP算法</h1><p>  KMP算法是一个很好的解决算法，它可以<strong>最多只扫描一次字符串<spanclass="math inline">\(A\)</span></strong>就能完成任务，即它的算法复杂度是<spanclass="math inline">\(O(n)\)</span>的。之所以被叫作KMP算法，是因为它是由Knuth、Morris、Pratt三个人提出的。下面来介绍一下该算法的思想。</p><h2 id="简单的直观模拟">简单的直观模拟</h2><p>  为了说明KMP的大致过程，我们先给出一个例子。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/06/03/nSwYj.webp" alt="一个例子" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">一个例子</span></div></div><p>  我们参考上例，并且称大数组为<spanclass="math inline">\(ch\)</span>，目标数组为<spanclass="math inline">\(target\)</span>。我们从第一位开始逐个比较<spanclass="math inline">\(ch\)</span>和<spanclass="math inline">\(target\)</span>中的每一位，直到不匹配为止，如图(a)所示。我们发现，<spanclass="math inline">\(ch[6]!=target[6]\)</span>。但是在<spanclass="math inline">\(i\leqslant 5\)</span>都有<spanclass="math inline">\(ch[i]=target[i]\)</span>。我们此时不将<spanclass="math inline">\(target\)</span>往后移动一位，选择往后移动两位，因为<strong>这个时候<spanclass="math inline">\(ch[2]\)</span>到<spanclass="math inline">\(ch[6]\)</span>仍然和目标字符串是匹配的。</strong>我们可以证明，这个位置是除了初始位置外第二个可能的匹配发生的位置。<strong>因为如果在此之前还存在一个匹配的字符串，那么我们要么已经找到了它，要么重定位会定位到它，而不是<span class="math inline">\(ch[2]\)</span></strong>。如果你能理解这点，这就是KMP算法的基本原理。</p><h2 id="失效函数">失效函数</h2><h3 id="失效函数原理">失效函数原理</h3><p>  那么随之而来的问题是：<strong>我们如何确定应该向后移动几位呢？</strong>以及，如果每次向后移动都可以看做字符串<spanclass="math inline">\(target\)</span>正在比较元素的<strong>后退</strong>，<em>（正如上例中本在比较<spanclass="math inline">\(target[6]\)</span>和<spanclass="math inline">\(ch[6]\)</span>，向后移动后相当于比较<spanclass="math inline">\(target[4]\)</span>和<spanclass="math inline">\(ch[6]\)</span>）</em>那么到底<strong>后退几位呢？</strong>如果我们把字符串中正在比较的元素位置记作<spanclass="math inline">\(j\)</span>，后退后正在比较<spanclass="math inline">\(j^\prime\)</span>，那么我们可以知道它们满足：<spanclass="math inline">\(target[0]\)</span>到<spanclass="math inline">\(target[j^\prime]\)</span>之间的字符串和<spanclass="math inline">\(target[j-j^\prime]\)</span>到<spanclass="math inline">\(target[j]\)</span>之间的字符串<strong>完全相同</strong>。这里需要读者仔细理解一下，我们实际上取的<spanclass="math inline">\(j^\prime\)</span>是使得<spanclass="math inline">\(target\)</span>中前<spanclass="math inline">\(j^\prime+1\)</span>和后<spanclass="math inline">\(j^\prime+1\)</span>个字符完全相同，也就是我们在前一节说的直观模拟的结果。</p><p>  我们把<span class="math inline">\(j\)</span>和<spanclass="math inline">\(j^\prime\)</span>的对应关系称为<strong>失效函数</strong>，即</p><p><span class="math display">\[j^\prime =P[j].\]</span></p><p>有了这个对应关系，我们就可以轻松决定，当字符串正在比较位置<spanclass="math inline">\(i,j\)</span>相同，即<spanclass="math inline">\(ch[i]=target[j]\)</span>时，但位置<spanclass="math inline">\(i+1,j+1\)</span>不同，即<spanclass="math inline">\(ch[i+1]\neq target[j+1]\)</span>时，<spanclass="math inline">\(j\)</span>需要更新成什么了。</p><h3 id="失效函数的算法">失效函数的算法</h3><p>  我们从上述论断中可以知道，<strong>失效函数的产生只和目标数组<spanclass="math inline">\(target\)</span>有关</strong>，因此我们可以对目标数组预处理，得到其失效函数。那么，失效函数的算法是什么呢？</p><p>  首先，我们知道对于<spanclass="math inline">\(target[0]\)</span>，是没有满足失效函数定义的下标<spanclass="math inline">\(j^\prime\)</span>的，那么，我们<strong>定义这种条件下，其失效函数值为-1</strong>。然后我们用<strong>递推</strong>的方式求出其他元素的失效函数。我们现在要求下标为<spanclass="math inline">\(j\)</span>的元素的失效函数，那么我们考察<spanclass="math inline">\(j-1\)</span>位置上的元素，其失效函数的值为<spanclass="math inline">\(j_0\)</span>，那么也就是说，<spanclass="math inline">\(target[0]\)</span>到<spanclass="math inline">\(target[j_0]\)</span>之间的字符串和<spanclass="math inline">\(target[j-1-j_0]\)</span>到<spanclass="math inline">\(target[j-1]\)</span>之间的字符串<strong>完全相同</strong>，那么我们只要比较<spanclass="math inline">\(target[j_0+1]\)</span>和<spanclass="math inline">\(target[j]\)</span>是否相同，<strong>即比较<spanclass="math inline">\(target[P[j-1]+1]\)</span>和<spanclass="math inline">\(target[j]\)</span>是否相同</strong>。如果也相同，那么<spanclass="math inline">\(P[j-1]+1=P[j]\)</span>；否则，我们可以令<spanclass="math inline">\(P[j_0]\)</span>是新的<spanclass="math inline">\(j_0\)</span>，继续反复上次的比较，直到找到<spanclass="math inline">\(target[0]\)</span>并且<spanclass="math inline">\(target[0]\)</span>和<spanclass="math inline">\(target[j]\)</span>也不相等，那么其<strong>失效函数的值为-1</strong>。</p><h3 id="失效函数的实现">失效函数的实现</h3><p>  这节给出失效函数failurefunc()的实现。 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span>* <span class="title">failurefunc</span><span class="params">(<span class="type">const</span> seqString&amp; target)</span><span class="type">const</span></span>&#123;</span><br><span class="line">    <span class="type">int</span>* p=<span class="keyword">new</span> <span class="type">int</span>[target.len];<span class="comment">//申请一个数组，存放失效函数</span></span><br><span class="line">    <span class="type">int</span> j;</span><br><span class="line"></span><br><span class="line">    p[<span class="number">0</span>]=<span class="number">-1</span>;<span class="comment">//首元素的失效函数值为-1</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;target.len;++i)&#123;</span><br><span class="line">        j=i<span class="number">-1</span>;<span class="comment">//往前退一位</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(j&gt;=<span class="number">0</span>&amp;&amp;target.data[p[j]+<span class="number">1</span>]!=target.data[i]) j=p[j];<span class="comment">//如果最长相同子序列不存在，那么缩短相同子序列长度</span></span><br><span class="line">        <span class="keyword">if</span>(j&lt;<span class="number">0</span>) p[i]=<span class="number">-1</span>;<span class="comment">//直到找完都没有找到，则失效函数为-1</span></span><br><span class="line">        <span class="keyword">else</span> p[i]=p[j]+<span class="number">1</span>;<span class="comment">//找到了，更新失效函数的值</span></span><br><span class="line">    &#125;<span class="comment">//end for</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;<span class="comment">//end function</span></span><br></pre></td></tr></table></figure></p><h2 id="查找函数">查找函数</h2><p>  有了上面的失效函数，我们可以完成KMP算法中的查找部分了。</p><h3 id="查找函数的原理">查找函数的原理</h3><p>  查找函数使用两个指针<span class="math inline">\(i\)</span>和<spanclass="math inline">\(j\)</span>，分别指向字符串<spanclass="math inline">\(ch\)</span>和<spanclass="math inline">\(target\)</span>中正在比较的元素。从两字符串头开始，对<spanclass="math inline">\(i,j\)</span>一同自增，直到发现<spanclass="math inline">\(ch[i]!=target[j]\)</span>就停止；此时，利用失效函数，对<spanclass="math inline">\(j\)</span>的值进行更新，更新为其前一个元素失效函数的值后的元素，即<spanclass="math inline">\(P[j-1]+1\)</span>，然后<strong>重新比较<spanclass="math inline">\(i\)</span>和<spanclass="math inline">\(j\)</span></strong>，重复上述步骤，直到<spanclass="math inline">\(j=0\)</span>时还是无法匹配，则固定<spanclass="math inline">\(j\)</span>，对<spanclass="math inline">\(i\)</span>自增，直到匹配为止。搜索过程退出的条件是：找到了<spanclass="math inline">\(target\)</span>的位置，即<spanclass="math inline">\(j=target.len-1\)</span>；或者未找到，即<spanclass="math inline">\(i=ch.len-1\)</span>。</p><h3 id="查找函数的实现">查找函数的实现</h3><p>  本节实现查找函数。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">const</span> seqString &amp; ch, <span class="type">const</span> seqString &amp; target)</span></span>&#123;</span><br><span class="line">    <span class="type">int</span>* p=<span class="literal">NULL</span>;<span class="comment">//存放失效函数</span></span><br><span class="line">    p=<span class="built_in">failurefunc</span>(target);<span class="comment">//获取失效函数</span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i=j=<span class="number">0</span>;<span class="comment">//定位指针</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(i&lt;ch.len&amp;&amp;j&lt;target.len)&#123;</span><br><span class="line">        <span class="keyword">if</span>(ch.data[i]==target.data[j]) &#123;i++;j++;&#125;<span class="comment">//相等则自增</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(j==<span class="number">0</span>) i++;<span class="comment">//不相等但是j已经为零时，i自增</span></span><br><span class="line">            <span class="keyword">else</span> j=p[j<span class="number">-1</span>]+<span class="number">1</span>;<span class="comment">//否则更新j的值 </span></span><br><span class="line">    &#125;<span class="comment">//end while</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> p;<span class="comment">//释放内存</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(j==target.len) <span class="comment">//比较完最后一个字符后，j又自增了一次，所以应该是最后一个元素的下标+1</span></span><br><span class="line">        <span class="keyword">return</span> i-j;<span class="comment">//如果找到了以后才退出，那么返回位置</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;<span class="comment">//否则就是没找到，返回未找到</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="后记">后记</h1><p>  KMP算法的时间复杂度是<spanclass="math inline">\(O(n)\)</span>的，因为我们即便可能需要扫描目标字符串许多遍，但主字符串我们只需要扫描一遍，也就是说不会超过<spanclass="math inline">\(n\)</span>次。KMP算法为什么能节省时间，本质上使我们利用了扫描匹配过程中匹配失败的信息。<strong>对于匹配失败的节点，我们利用两个指针直接跳过了许多次扫描</strong>，因而节省了时间。可以说，<strong>KMP算法相比于枚举法有着更高的信息利用率。</strong></p>]]></content>
    
    
    <summary type="html">字符串的基本操作之一是find()函数，即从某一个字符串中找到对应的子串位置。KMP算法是目前为止最为广泛使用的寻找子字符串的算法。</summary>
    
    
    
    <category term="学习笔记" scheme="https://blog.felixchen0707.cn/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="数据结构" scheme="https://blog.felixchen0707.cn/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    
    <category term="算法" scheme="https://blog.felixchen0707.cn/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>RSA加密算法</title>
    <link href="https://blog.felixchen0707.cn/posts/c8b4e820/"/>
    <id>https://blog.felixchen0707.cn/posts/c8b4e820/</id>
    <published>2022-05-18T02:46:46.000Z</published>
    <updated>2022-05-18T02:46:46.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="加密算法">加密算法</h1><p>  谈到加密算法，我们不得不谈一下密码学中加密算法的两个分支：<strong>对称加密</strong>和<strong>非对称加密</strong>。</p><h2id="对称加密算法以单表替代密码为例">对称加密算法（以单表替代密码为例）</h2><p>  我们假设Felix要向你们之间的某位读者发送一段信息<spanclass="math inline">\(m\)</span>，为方便起见，我们假设这段信息是"THANKYOUFORFOLLOWINGME"。现在，为了使这段信息不被外人所知，需要对其加密。我们假设加密方式为：<strong>所有用后一位字母替代</strong>，那么上述的这段信息就被加密为："UIBOLZPVGPSGPMMPXJOHNF"，这是<strong>不可读的</strong>。当读者接收到这段信息时，只需要将加密后的信息往前倒退一位，便可以得到原始信息。我们把原始信息称为<strong>明文</strong>，加密后的信息称为<strong>密文</strong>，加密方式（在上例中体现为字母的替代）称为<strong>加密算法</strong>，解密方式（在上例中体现为字母的替代）称为<strong>解密算法</strong>，加密时移动的位数1称为<strong>加密密钥</strong>，解密时移动的位数1称为<strong>解密密钥</strong>。</p><p>  上面这种加密方式一般被称为<strong>单表替代密码</strong>，上述的例子又是其中十分特殊的一种，称为<strong>凯撒密码</strong>。我们观察可以知道，加密密钥和解密密钥是相同的，我们把具有这种性质的加密算法称为<strong>对称加密算法</strong>。</p><p>  对称加密算法是有好处的：其计算量小，加密简单，用于加密和解密的密钥相同，算法只需要选取<strong>可逆映射</strong>即可。但对称加密也存在一些问题：双方在通信前需要互相商定密钥，并且在通信过程中，任何一方的密钥泄露都将使得所有通信被破解；其次，任何两者之间的通信都需要选取<strong>不同的密钥</strong>，这在通信网复杂的情况下，每个通信节点都需要储存数量庞大的密钥，给用户带来负担。</p><p>  当然，密钥泄露的问题不是不可解决的。我们可以在每一次通信都使用不同的密钥，这样，密文在理论上是<strong>牢不可破的</strong>。但是这又会带来问题，我们如何获得这么庞大数量的密钥呢？我们又如何储存呢？密钥的分发在这种情况下变成了棘手的问题。所以，<strong>一次一密</strong>的加密方式在实际应用中是不广泛的。</p><h2 id="非对称加密">非对称加密</h2><p>  随即而来进入我们脑海的一种加密方式就是非对称加密，即<strong>加密密钥</strong>和<strong>解密密钥</strong>不相同的加密方式。我们一般称前者为<strong>公钥</strong>，后者为<strong>私钥</strong>，因为前者是公开给所有人的，后者是密文接收方自己保存的。我们知道，由于加密和解密是逆运算，我们是有可能通过暴力破解求出加密方式的逆运算的。所以，为了保证安全性，非对称加密的算法一般都<strong>十分复杂</strong>，运算量相比于对称加密算法繁琐得多，因此，非对称加密<strong>牺牲了加密效率，换来了更高的安全性</strong>。下面我们来讨论一下非对称加密中的典型加密方式，即RSA加密。</p><h1 id="rsa加密算法">RSA加密算法</h1><h2 id="基于的数学运算原理模运算">基于的数学运算原理——模运算</h2><p>  首先我们来思考一个问题，有什么方式使得<strong>攻击者知道加密方式的情况下很难求算出其逆运算</strong>？有一种运算符合类似的性质：其正向运算十分简单，但逆运算极其复杂，它是模运算（Mod）。模运算就是我们一般说的求余。其正向运算是很简单的，例如<span class="math display">\[3^3\ \textrm{mod}\ 7=6,\]</span>完成这个运算只需要一个简单的除法即可，但是设想，如果给出的形式是方程，即<span class="math display">\[3^x\ \textrm{mod}\ 7=6,\]</span>求解满足上述方程的x的值，其运算是比较复杂的，因为我们不知道其商的值，也就不能快速利用乘法求算<spanclass="math inline">\(x\)</span>，一般我们会使用枚举法求算其解。但是如果方程是<span class="math display">\[3^x\ \textrm{mod}\ 7156464845153468615315646=6,\]</span>这时候，枚举法也变得十分困难了，这个方程已经是<strong>计算上不可解的</strong>了。因此，模运算也被称为<strong>单向运算</strong>。RSA就是利用了模运算的这点性质。</p><h2 id="加密算法和解密算法确定">加密算法和解密算法确定</h2><p>  知道了我们要使用模运算作为加密和解密算法，那么我们不妨假设明文信息是<spanclass="math inline">\(m\)</span>（message），密文信息是<spanclass="math inline">\(c\)</span>（cipher），公钥为<spanclass="math inline">\(e\)</span>，私钥为<spanclass="math inline">\(d\)</span>，于是我们可以得到 <spanclass="math display">\[\begin{cases}    m^e\ \textrm{mod}\ N=c,\\    c^d\ \textrm{mod}\ N=m.\end{cases}\]</span> 消去密文<span class="math inline">\(c\)</span>，上式可化为<span class="math display">\[(m^e\ \textrm{mod}\ N)^d\ \textrm{mod}\ N=m,\]</span> 可以证明上式等价于 <span class="math display">\[m^{ed}\ \textrm{mod}\ N=m.\]</span> 这个结论先放在这里，我们后续会使用到它。</p><h2 id="欧拉函数和欧拉定理">欧拉函数和欧拉定理</h2><p>  为了充分理解RSA密码的数学原理，我们需要先提到<strong>欧拉函数</strong>和<strong>欧拉定理</strong>。</p><h3 id="欧拉函数">欧拉函数</h3><p>  首先介绍一下欧拉函数：假设给定一个正整数<spanclass="math inline">\(n\)</span>，欧拉函数<spanclass="math inline">\(\varphi(n)\)</span>的值是<strong>不超过<spanclass="math inline">\(n\)</span>的与其互质的正整数的数目</strong>，例如不超过6的与6互质的正整数有1和5，那么我们就说，<spanclass="math inline">\(\varphi(6)=2\)</span>。一般求解欧拉函数的值时，我们经常采用素因数分解的方式，让我们来看一个例子：求解<spanclass="math inline">\(\varphi(100)\)</span>的值。我们对其质因数分解，得到<span class="math display">\[100=2^2\cdot 5^2。\]</span> 那么其与其互质的整数数量为 <span class="math display">\[\varphi(100)=100\times(1-\dfrac{1}{2})\times(1-\dfrac{1}{5})=40.\]</span> 对于任意正整数<spanclass="math inline">\(x\)</span>，假设其各个质因数为<spanclass="math inline">\(p_i\)</span>，那么其欧拉函数的值为 <spanclass="math display">\[\varphi(x)=x\prod^n_{i=1}(1-\dfrac{1}{p_i}).\]</span>显然，这样计算一个正整数的欧拉函数是很复杂的。但如果上式中的<spanclass="math inline">\(x\)</span>是质数呢？问题就变得非常简单，因为这时<spanclass="math inline">\(P_i=\{x\}\)</span>。于是我们可以知道，质数<spanclass="math inline">\(p\)</span>的欧拉函数为 <spanclass="math display">\[\varphi(p)=p-1.\]</span> 同样的，如果对于两个互质的正整数<spanclass="math inline">\(p,q\)</span>，其乘积的欧拉函数就等于欧拉函数的乘积，即<span class="math display">\[\varphi(p\times q)=\varphi(p)\times \varphi(q).\]</span> 这为我们求解欧拉函数提供了一个很好的解决方式。</p><h3 id="欧拉定理">欧拉定理</h3><p>  欧拉定理是数论中的重要定理，我们这里只做介绍，不作证明。欧拉定理说的是，对于互质的两正整数<spanclass="math inline">\(m\)</span>和<spanclass="math inline">\(n\)</span>，满足以下关系恒成立： <spanclass="math display">\[m^{\varphi(n)}\equiv1\ (\textrm{mod}\ n),\]</span> 我们对上式两边同时取<spanclass="math inline">\(k\)</span>次幂，得到 <span class="math display">\[m^{k\varphi(n)}\equiv1\ (\textrm{mod}\ n),\]</span> 两边同时乘上<span class="math inline">\(m\)</span>，有 <spanclass="math display">\[m^{k\varphi(n)+1}\equiv m\ (\textrm{mod}\ n),\]</span> 改写得到 <span class="math display">\[m^{k\varphi(n)+1}\ \textrm{mod}\ n= m.\]</span> 这是我们需要的欧拉定理的形式。</p><h2 id="密钥的生成">密钥的生成</h2><p>  读者是否还记得我们在确定算法的时候找到了公钥和私钥的关系式？即<span class="math display">\[m^{ed}\ \textrm{mod}\ N=m.\]</span> 与我们得到的欧拉定理的形式 <span class="math display">\[m^{k\varphi(n)+1}\ \textrm{mod}\ n=m.\]</span> 相比，我们发现，这时我们只需要使得 <spanclass="math display">\[ed=k\varphi(N)+1，\]</span> 即对于任何一个公钥<spanclass="math inline">\(e\)</span>，我们私钥<spanclass="math inline">\(d\)</span>的生成方式为计算<spanclass="math inline">\(d\)</span>使得 <span class="math display">\[ed\ \textrm{mod}\ \varphi(N)=1.\]</span>这时我们可以利用到一条数学定理：如果两正整数互质（这里表现为<spanclass="math inline">\(d\)</span>与<spanclass="math inline">\(\varphi(N)\)</span>互质），那么一定存在<spanclass="math inline">\(d\)</span>满足上述关系，即<spanclass="math inline">\(ed-1\)</span>被<spanclass="math inline">\(\varphi(N)\)</span>整除，我们称这样的<spanclass="math inline">\(d\)</span>为<strong>模反元素</strong>。</p><p>  所以，我们只要保证公钥<spanclass="math inline">\(e\)</span>和求得的<spanclass="math inline">\(\varphi(N)\)</span>互质，那么私钥<spanclass="math inline">\(d\)</span>的存在性是不言而喻的。那么现在问题的关键就是：如何确定<spanclass="math inline">\(\varphi(N)\)</span>和<spanclass="math inline">\(e\)</span>的值。</p><p>  我们任意选取足够大的两个质数<spanclass="math inline">\(p\)</span>和<spanclass="math inline">\(q\)</span>，这是我们产生<spanclass="math inline">\(\varphi(N)\)</span>的来源。我们令<spanclass="math inline">\(N=p\cdot q\)</span>，这样的<spanclass="math inline">\(N\)</span>通常是非常大的，理论上计算<spanclass="math inline">\(\varphi(N)\)</span>需要对其进行质因数分解，然而对不知道<spanclass="math inline">\(p\)</span>和<spanclass="math inline">\(q\)</span>的人来说，这几乎是不可能的事情，因为<spanclass="math inline">\(N\)</span>的质因数分解被证明是<strong>计算上不可行的</strong>了。但作为密钥的分发方，我们却很容易解出，因为我们选取的是两个质数，利用欧拉函数的性质，我们很容易知道<span class="math display">\[\varphi(N)=\varphi(p\cdot q)=\varphi(p)\cdot\varphi(q)=(p-1)(q-1).\]</span> 有了这个解，我们只需要任意取一个和<spanclass="math inline">\(\varphi(N)\)</span>互质的数就行了。由此，我们将<spanclass="math inline">\((e,N)\)</span>作为公钥发送出去，待我们计算出<spanclass="math inline">\(d\)</span>后，保留<spanclass="math inline">\((d,N)\)</span>作为私钥即可。销毁<spanclass="math inline">\(p\)</span>和<spanclass="math inline">\(q\)</span>，这样这组公钥私钥几乎是无法被破解的了。</p><h2 id="加密流程总结">加密流程总结</h2><p>  至此，我们已经知道了加密基于的数学原理和方法，这里我们来一些总结。</p><hr /><table><colgroup><col style="width: 33%" /><col style="width: 33%" /><col style="width: 33%" /></colgroup><thead><tr class="header"><th style="text-align: center;">步骤</th><th style="text-align: center;">内容</th><th style="text-align: center;">生成</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">1</td><td style="text-align: center;">选取两个不相等的足够大的质数</td><td style="text-align: center;"><spanclass="math inline">\(p\)</span>和<spanclass="math inline">\(q\)</span></td></tr><tr class="even"><td style="text-align: center;">2</td><td style="text-align: center;">计算它们的乘积<spanclass="math inline">\(N=p\times q\)</span></td><td style="text-align: center;"><spanclass="math inline">\(N\)</span></td></tr><tr class="odd"><td style="text-align: center;">3</td><td style="text-align: center;">利用<spanclass="math inline">\(N\)</span>的因数计算其欧拉函数<spanclass="math inline">\(\varphi(N)=(p-1)\times(q-1)\)</span></td><td style="text-align: center;"><spanclass="math inline">\(\varphi(N)\)</span></td></tr><tr class="even"><td style="text-align: center;">4</td><td style="text-align: center;">选取任一与<spanclass="math inline">\(\varphi(N)\)</span>互质的整数<spanclass="math inline">\(e\)</span></td><td style="text-align: center;">公钥成员<spanclass="math inline">\(e\)</span></td></tr><tr class="odd"><td style="text-align: center;">5</td><td style="text-align: center;">计算模反元素<spanclass="math inline">\(d\)</span>：<span class="math inline">\(ed\\textrm{mod}\ \varphi(N)=1\)</span></td><td style="text-align: center;">私钥成员<spanclass="math inline">\(d\)</span></td></tr><tr class="even"><td style="text-align: center;">6</td><td style="text-align: center;">公布公钥<spanclass="math inline">\((e,N)\)</span></td><td style="text-align: center;">公钥<spanclass="math inline">\((e,N)\)</span></td></tr><tr class="odd"><td style="text-align: center;">7</td><td style="text-align: center;">保存私钥<spanclass="math inline">\((d,N)\)</span></td><td style="text-align: center;">私钥<spanclass="math inline">\((d,N)\)</span></td></tr><tr class="even"><td style="text-align: center;">8</td><td style="text-align: center;">销毁<spanclass="math inline">\(p\)</span>和<spanclass="math inline">\(q\)</span></td><td style="text-align: center;">无</td></tr></tbody></table><hr /><p>  这就是RSA加密算法的原理和流程。</p><h2 id="关于关键的p和q">关于关键的<spanclass="math inline">\(p\)</span>和<spanclass="math inline">\(q\)</span></h2><p>  我们知道，如果两个数很接近，那么<strong>它们的差值一定很小</strong>。如果我们选取的<spanclass="math inline">\(p\)</span>和<spanclass="math inline">\(q\)</span>相差不大，那么RSA在这种情况下是<strong>很容易被攻破的</strong>。我们可以假设<spanclass="math inline">\(p&gt;q\)</span>并且 <span class="math display">\[p=a+b,\quad q=a-b,\]</span> 那么大数<span class="math inline">\(N\)</span>就可以被表示为<span class="math display">\[N=p\times q=(a+b)(a-b)=a^2-b^2.\]</span> 由于<span class="math inline">\(b\)</span>很小，所以<spanclass="math inline">\(a\)</span>和<spanclass="math inline">\(\sqrt{N}\)</span>的值非常接近，于是我们可以轻易倒推出用于产生密钥的<spanclass="math inline">\(p\)</span>和<spanclass="math inline">\(q\)</span>的值。这种情况下，RSA的安全性很低。但好在幸运的是，应用中不会产生这样的错误，所以RSA依然是很可靠的加密方式。</p><h1 id="后记">后记</h1><p>  从对于RSA彻底的分析来看，密码学在本质上是数学的实际应用。笔者在理解RSA密码加密的学习过程中，其实更多的时候都在了解其基于的数学原理，而并非大多数人所认为的加密过程。站在一个高度看RSA密码，其实其可靠性是由于<strong>人类对质因数分解掌握的不完全</strong>所保证的，因为知道公钥<spanclass="math inline">\((e,N)\)</span>，从理论上是可以破解私钥的，只是<strong>实际不可行</strong>罢了。当然，我们也不能因此质疑RSA密码的可靠性，因为密码学对密码是否可用的标准一直只有两条：<strong>破解密码耗费的资源大于信息本身</strong>，或者<strong>破解密码需要的时间远大于信息的时效性</strong>，而并没有将牢不可破作为其中的标准。</p><p>  RSA密码在历史上首次是被政府发现的，然后其就一直作为机密被尘封起来。直到1977年，三位麻省理工的数学家独立发掘出这种公钥私钥计算方法，然后才成为了如今广泛使用的RSA加密算法。这个算法也由他们的名字命名：Ron<strong>R</strong>ivest,Adi <strong>S</strong>hamir,Leonard<strong>A</strong>dleman。</p><div class="tag-plugin image"><div class="image-bg"><img src="https://i.imgtg.com/2022/06/03/n0TDc.webp" alt="公开RSA的三位数学家" fancybox="true"/></div><div class="image-meta"><span class="image-caption center">公开RSA的三位数学家</span></div></div><p>  回过来看这个优美的表达式 <span class="math display">\[d=\dfrac{k\varphi(N)+1}{e},\]</span><strong>一对看似无关的数字却连接着探索真相的答案，一个看似简单的算法却暗藏着千年未解的数学难题</strong>，这或许就是密码最终的魅力。</p>]]></content>
    
    
    <summary type="html">RSA，如今最广泛使用的公钥加密算法。数字签名、数字证书、SSH、HTTPS的加密链接全是它的典型应用。RSA背后隐藏着什么？</summary>
    
    
    
    <category term="学习笔记" scheme="https://blog.felixchen0707.cn/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
    <category term="密码学" scheme="https://blog.felixchen0707.cn/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    
  </entry>
  
</feed>
